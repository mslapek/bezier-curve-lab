"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function downloadAsSVG(){main.echo("### SVG EXPORT ###"),main.echo(paper.project.exportSVG({asString:!0})),main.echo("##################")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},numeric="undefined"==typeof exports?function(){}:exports;"undefined"!=typeof global&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,r){var n,t,i,o;for(void 0===r&&(r=15),i=.5,n=new Date;;){for(i*=2,o=i;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;if((t=new Date)-n>r)break}for(o=i;o>3;o-=4)e(),e(),e(),e();for(;o>0;)e(),o--;return t=new Date,1e3*(3*i-1)/(t-n)},numeric._myIndexOf=function(e){var r,n=this.length;for(r=0;r<n;++r)if(this[r]===e)return r;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function r(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+r(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),t=e/Math.pow(10,n),i=t.toPrecision(numeric.precision);return 10===parseFloat(i)&&(n++,t=1,i=t.toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+n.toString()}return"Infinity"}function n(e){var i;if(void 0===e)return t.push(Array(numeric.precision+8).join(" ")),!1;if("string"==typeof e)return t.push('"'+e+'"'),!1;if("boolean"==typeof e)return t.push(e.toString()),!1;if("number"==typeof e){var o=r(e),u=e.toPrecision(numeric.precision),a=parseFloat(e.toString()).toString(),s=[o,u,a,parseFloat(u).toString(),parseFloat(a).toString()];for(i=1;i<s.length;i++)s[i].length<o.length&&(o=s[i]);return t.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===e)return t.push("null"),!1;if("function"==typeof e){t.push(e.toString());var c=!1;for(i in e)e.hasOwnProperty(i)&&(c?t.push(",\n"):t.push("\n{"),c=!0,t.push(i),t.push(": \n"),n(e[i]));return c&&t.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return t.push("...Large Array..."),!0;var c=!1;for(t.push("["),i=0;i<e.length;i++)i>0&&(t.push(","),c&&t.push("\n ")),c=n(e[i]);return t.push("]"),!0}t.push("{");var c=!1;for(i in e)e.hasOwnProperty(i)&&(c&&t.push(",\n"),c=!0,t.push(i),t.push(": \n"),n(e[i]));return t.push("}"),!0}var t=[];return n(e),t.join("")},numeric.parseDate=function(e){function r(e){if("string"==typeof e)return Date.parse(e.replace(/-/g,"/"));if(e instanceof Array){var n,t=[];for(n=0;n<e.length;n++)t[n]=r(e[n]);return t}throw new Error("parseDate: parameter must be arrays of strings")}return r(e)},numeric.parseFloat=function(e){function r(e){if("string"==typeof e)return parseFloat(e);if(e instanceof Array){var n,t=[];for(n=0;n<e.length;n++)t[n]=r(e[n]);return t}throw new Error("parseFloat: parameter must be arrays of strings")}return r(e)},numeric.parseCSV=function(e){var r,n,t=e.split("\n"),i=[],o=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,u=0;for(n=0;n<t.length;n++){var a,s=(t[n]+",").match(/(([^'",]*)|('[^']*')|("[^"]*")),/g);if(s.length>0){for(i[u]=[],r=0;r<s.length;r++)a=function(e){return e.substr(0,e.length-1)}(s[r]),o.test(a)?i[u][r]=parseFloat(a):i[u][r]=a;u++}}return i},numeric.toCSV=function(e){var r,n,t,i,o,u=numeric.dim(e);for(t=u[0],u[1],o=[],r=0;r<t;r++){for(i=[],n=0;n<t;n++)i[n]=e[r][n].toString();o[r]=i.join(", ")}return o.join("\n")+"\n"},numeric.getURL=function(e){var r=new XMLHttpRequest;return r.open("GET",e,!1),r.send(),r},numeric.imageURL=function(e){function r(e,r,n){void 0===r&&(r=0),void 0===n&&(n=e.length);var t,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1,u=0;e.length;for(t=r;t<n;t++)u=255&(o^e[t]),o=o>>>8^i[u];return-1^o}var n,t,i,o,u,a,s,c,f,l,m=e[0].length,h=e[0][0].length,p=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,h>>24&255,h>>16&255,h>>8&255,255&h,m>>24&255,m>>16&255,m>>8&255,255&m,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(l=r(p,12,29),p[29]=l>>24&255,p[30]=l>>16&255,p[31]=l>>8&255,p[32]=255&l,n=1,t=0,s=0;s<m;s++){for(s<m-1?p.push(0):p.push(1),u=3*h+1+(0===s)&255,a=3*h+1+(0===s)>>8&255,p.push(u),p.push(a),p.push(255&~u),p.push(255&~a),0===s&&p.push(0),c=0;c<h;c++)for(i=0;i<3;i++)u=e[i][s][c],u=u>255?255:u<0?0:Math.round(u),n=(n+u)%65521,t=(t+n)%65521,p.push(u);p.push(0)}return f=(t<<16)+n,p.push(f>>24&255),p.push(f>>16&255),p.push(f>>8&255),p.push(255&f),o=p.length-41,p[33]=o>>24&255,p[34]=o>>16&255,p[35]=o>>8&255,p[36]=255&o,l=r(p,37),p.push(l>>24&255),p.push(l>>16&255),p.push(l>>8&255),p.push(255&l),p.push(0),p.push(0),p.push(0),p.push(0),p.push(73),p.push(69),p.push(78),p.push(68),p.push(174),p.push(66),p.push(96),p.push(130),"data:image/png;base64,"+function(e){var r,n,t,i,o,u,a,s,c=e.length,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="";for(r=0;r<c;r+=3)n=e[r],t=e[r+1],i=e[r+2],o=n>>2,u=((3&n)<<4)+(t>>4),a=((15&t)<<2)+(i>>6),s=63&i,r+1>=c?a=s=64:r+2>=c&&(s=64),l+=f.charAt(o)+f.charAt(u)+f.charAt(a)+f.charAt(s);return l}(p)},numeric._dim=function(e){for(var r=[];"object"==(void 0===e?"undefined":_typeof(e));)r.push(e.length),e=e[0];return r},numeric.dim=function(e){var r,n;return"object"==(void 0===e?"undefined":_typeof(e))?(r=e[0],"object"==(void 0===r?"undefined":_typeof(r))?(n=r[0],"object"==(void 0===n?"undefined":_typeof(n))?numeric._dim(e):[e.length,r.length]):[e.length]):[]},numeric.mapreduce=function(e,r){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+r+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,r){return Function("x","var n = x.length;\nvar i,xi;\n"+r+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(r,n){var t,i;if(r instanceof Array&&n instanceof Array){if((i=r.length)!==n.length)return!1;for(t=0;t<i;t++)if(r[t]!==n[t]){if("object"!=_typeof(r[t]))return!1;if(!e(r[t],n[t]))return!1}return!0}return!1},numeric.rep=function(e,r,n){void 0===n&&(n=0);var t,i=e[n],o=Array(i);if(n===e.length-1){for(t=i-2;t>=0;t-=2)o[t+1]=r,o[t]=r;return-1===t&&(o[0]=r),o}for(t=i-1;t>=0;t--)o[t]=numeric.rep(e,r,n+1);return o},numeric.dotMMsmall=function(e,r){var n,t,i,o,u,a,s,c,f,l,m;for(o=e.length,u=r.length,a=r[0].length,s=Array(o),n=o-1;n>=0;n--){for(c=Array(a),f=e[n],i=a-1;i>=0;i--){for(l=f[u-1]*r[u-1][i],t=u-2;t>=1;t-=2)m=t-1,l+=f[t]*r[t][i]+f[m]*r[m][i];0===t&&(l+=f[0]*r[0][i]),c[i]=l}s[n]=c}return s},numeric._getCol=function(e,r,n){var t,i=e.length;for(t=i-1;t>0;--t)n[t]=e[t][r],--t,n[t]=e[t][r];0===t&&(n[0]=e[0][r])},numeric.dotMMbig=function(e,r){var n,t,i,o=numeric._getCol,u=r.length,a=Array(u),s=e.length,c=r[0].length,f=new Array(s),l=numeric.dotVV;for(--u,--s,t=s;-1!==t;--t)f[t]=Array(c);for(--c,t=c;-1!==t;--t)for(o(r,t,a),i=s;-1!==i;--i)0,n=e[i],f[i][t]=l(n,a);return f},numeric.dotMV=function(e,r){var n,t=e.length,i=(r.length,Array(t)),o=numeric.dotVV;for(n=t-1;n>=0;n--)i[n]=o(e[n],r);return i},numeric.dotVM=function(e,r){var n,t,i,o,u,a,s;for(i=e.length,o=r[0].length,u=Array(o),t=o-1;t>=0;t--){for(a=e[i-1]*r[i-1][t],n=i-2;n>=1;n-=2)s=n-1,a+=e[n]*r[n][t]+e[s]*r[s][t];0===n&&(a+=e[0]*r[0][t]),u[t]=a}return u},numeric.dotVV=function(e,r){var n,t,i=e.length,o=e[i-1]*r[i-1];for(n=i-2;n>=1;n-=2)t=n-1,o+=e[n]*r[n]+e[t]*r[t];return 0===n&&(o+=e[0]*r[0]),o},numeric.dot=function(e,r){var n=numeric.dim;switch(1e3*n(e).length+n(r).length){case 2002:return r.length<10?numeric.dotMMsmall(e,r):numeric.dotMMbig(e,r);case 2001:return numeric.dotMV(e,r);case 1002:return numeric.dotVM(e,r);case 1001:return numeric.dotVV(e,r);case 1e3:return numeric.mulVS(e,r);case 1:return numeric.mulSV(e,r);case 0:return e*r;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var r,n,t,i,o=e.length,u=Array(o);for(r=o-1;r>=0;r--){for(i=Array(o),n=r+2,t=o-1;t>=n;t-=2)i[t]=0,i[t-1]=0;for(t>r&&(i[t]=0),i[r]=e[r],t=r-1;t>=1;t-=2)i[t]=0,i[t-1]=0;0===t&&(i[0]=0),u[r]=i}return u},numeric.getDiag=function(e){var r,n=Math.min(e.length,e[0].length),t=Array(n);for(r=n-1;r>=1;--r)t[r]=e[r][r],--r,t[r]=e[r][r];return 0===r&&(t[0]=e[0][0]),t},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,r,n){void 0===n&&(n="");var t,i,o=[],u=/\[i\]$/,a="",s=!1;for(t=0;t<e.length;t++)u.test(e[t])?(i=e[t].substring(0,e[t].length-3),a=i):i=e[t],"ret"===i&&(s=!0),o.push(i);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+a+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(s?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+r+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,r,n){void 0===n&&(n="");var t,i,o=[],u=/\[i\]$/,a="",s=!1;for(t=0;t<e.length;t++)u.test(e[t])?(i=e[t].substring(0,e[t].length-3),a=i):i=e[t],"ret"===i&&(s=!0),o.push(i);return o[e.length]="var _n = "+a+".length;\nvar i"+(s?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+r+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function e(r,n,t,i,o){if(i===t.length-1)return void o(r,n);var u,a=t[i];for(u=a-1;u>=0;u--)e("object"==(void 0===r?"undefined":_typeof(r))?r[u]:r,"object"==(void 0===n?"undefined":_typeof(n))?n[u]:n,t,i+1,o)},numeric._biforeach2=function e(r,n,t,i,o){if(i===t.length-1)return o(r,n);var u,a=t[i],s=Array(a);for(u=a-1;u>=0;--u)s[u]=e("object"==(void 0===r?"undefined":_typeof(r))?r[u]:r,"object"==(void 0===n?"undefined":_typeof(n))?n[u]:n,t,i+1,o);return s},numeric._foreach=function e(r,n,t,i){if(t===n.length-1)return void i(r);var o,u=n[t];for(o=u-1;o>=0;o--)e(r[o],n,t+1,i)},numeric._foreach2=function e(r,n,t,i){if(t===n.length-1)return i(r);var o,u=n[t],a=Array(u);for(o=u-1;o>=0;o--)a[o]=e(r[o],n,t+1,i);return a},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,r;for(e=0;e<numeric.mathfuns2.length;++e)r=numeric.mathfuns2[e],numeric.ops2[r]=r;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){r=numeric.ops2[e];var n,t,i="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(i="var "+r+" = Math."+r+";\n",n=function(e,n,t){return e+" = "+r+"("+n+","+t+")"},t=function(e,n){return e+" = "+r+"("+e+","+n+")"}):(n=function(e,n,t){return e+" = "+n+" "+r+" "+t},t=numeric.opseq.hasOwnProperty(e+"eq")?function(e,n){return e+" "+r+"= "+n}:function(e,n){return e+" = "+e+" "+r+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+t("x","y")+"\n}\nreturn x;\n"),numeric[r]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],t("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],t("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)r=numeric.mathfuns2[e],delete numeric.ops2[r];for(e=0;e<numeric.mathfuns.length;++e)r=numeric.mathfuns[e],numeric.ops1[r]=r;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",r=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(r)&&(i="var "+r+" = Math."+r+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+r+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+r+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+r+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+r+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)r=numeric.mathfuns[e],delete numeric.ops1[r];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(r=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(r[0],r[1]),numeric[e]=Function("x","s","k",r[1]+'if(typeof x !== "object") {    xi = x;\n'+r[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+r[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,r){return"object"==(void 0===e?"undefined":_typeof(e))?"object"==(void 0===r?"undefined":_typeof(r))?numeric.truncVV(e,r):numeric.truncVS(e,r):"object"==(void 0===r?"undefined":_typeof(r))?numeric.truncSV(e,r):Math.round(e/r)*r},numeric.inv=function(e){var r,n,t,i,o,u,a,e,s=numeric.dim(e),c=Math.abs,f=s[0],l=s[1],m=numeric.clone(e),h=numeric.identity(f);for(u=0;u<l;++u){var p=-1,y=-1;for(o=u;o!==f;++o)(a=c(m[o][u]))>y&&(p=o,y=a);for(n=m[p],m[p]=m[u],m[u]=n,i=h[p],h[p]=h[u],h[u]=i,e=n[u],a=u;a!==l;++a)n[a]/=e;for(a=l-1;-1!==a;--a)i[a]/=e;for(o=f-1;-1!==o;--o)if(o!==u){for(r=m[o],t=h[o],e=r[u],a=u+1;a!==l;++a)r[a]-=n[a]*e;for(a=l-1;a>0;--a)t[a]-=i[a]*e,--a,t[a]-=i[a]*e;0===a&&(t[0]-=i[0]*e)}}return h},numeric.det=function(e){var r=numeric.dim(e);if(2!==r.length||r[0]!==r[1])throw new Error("numeric: det() only works on square matrices");var n,t,i,o,u,a,s,c,f=r[0],l=1,m=numeric.clone(e);for(t=0;t<f-1;t++){for(i=t,n=t+1;n<f;n++)Math.abs(m[n][t])>Math.abs(m[i][t])&&(i=n);for(i!==t&&(s=m[i],m[i]=m[t],m[t]=s,l*=-1),o=m[t],n=t+1;n<f;n++){for(u=m[n],a=u[t]/o[t],i=t+1;i<f-1;i+=2)c=i+1,u[i]-=o[i]*a,u[c]-=o[c]*a;i!==f&&(u[i]-=o[i]*a)}if(0===o[t])return 0;l*=o[t]}return l*m[t][t]},numeric.transpose=function(e){var r,n,t,i,o,u=e.length,a=e[0].length,s=Array(a);for(n=0;n<a;n++)s[n]=Array(u);for(r=u-1;r>=1;r-=2){for(i=e[r],t=e[r-1],n=a-1;n>=1;--n)o=s[n],o[r]=i[n],o[r-1]=t[n],--n,o=s[n],o[r]=i[n],o[r-1]=t[n];0===n&&(o=s[0],o[r]=i[0],o[r-1]=t[0])}if(0===r){for(t=e[0],n=a-1;n>=1;--n)s[n][0]=t[n],--n,s[n][0]=t[n];0===n&&(s[0][0]=t[0])}return s},numeric.negtranspose=function(e){var r,n,t,i,o,u=e.length,a=e[0].length,s=Array(a);for(n=0;n<a;n++)s[n]=Array(u);for(r=u-1;r>=1;r-=2){for(i=e[r],t=e[r-1],n=a-1;n>=1;--n)o=s[n],o[r]=-i[n],o[r-1]=-t[n],--n,o=s[n],o[r]=-i[n],o[r-1]=-t[n];0===n&&(o=s[0],o[r]=-i[0],o[r-1]=-t[0])}if(0===r){for(t=e[0],n=a-1;n>=1;--n)s[n][0]=-t[n],--n,s[n][0]=-t[n];0===n&&(s[0][0]=-t[0])}return s},numeric._random=function e(r,n){var t,i,o=r[n],u=Array(o);if(n===r.length-1){for(i=Math.random,t=o-1;t>=1;t-=2)u[t]=i(),u[t-1]=i();return 0===t&&(u[0]=i()),u}for(t=o-1;t>=0;t--)u[t]=e(r,n+1);return u},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,r,n){if(void 0===n&&(n=Math.max(Math.round(r-e)+1,1)),n<2)return 1===n?[e]:[];var t,i=Array(n);for(n--,t=n;t>=0;t--)i[t]=(t*r+(n-t)*e)/n;return i},numeric.getBlock=function(e,r,n){function t(e,o){var u,a=r[o],s=n[o]-a,c=Array(s);if(o===i.length-1){for(u=s;u>=0;u--)c[u]=e[u+a];return c}for(u=s;u>=0;u--)c[u]=t(e[u+a],o+1);return c}var i=numeric.dim(e);return t(e,0)},numeric.setBlock=function(e,r,n,t){function i(e,t,u){var a,s=r[u],c=n[u]-s;if(u===o.length-1)for(a=c;a>=0;a--)e[a+s]=t[a];for(a=c;a>=0;a--)i(e[a+s],t[a],u+1)}var o=numeric.dim(e);return i(e,t,0),e},numeric.getRange=function(e,r,n){var t,i,o,u,a=r.length,s=n.length,c=Array(a);for(t=a-1;-1!==t;--t)for(c[t]=Array(s),o=c[t],u=e[r[t]],i=s-1;-1!==i;--i)o[i]=u[n[i]];return c},numeric.blockMatrix=function(e){var r=numeric.dim(e);if(r.length<4)return numeric.blockMatrix([e]);var n,t,i,o,u,a=r[0],s=r[1];for(n=0,t=0,i=0;i<a;++i)n+=e[i][0].length;for(o=0;o<s;++o)t+=e[0][o][0].length;var c=Array(n);for(i=0;i<n;++i)c[i]=Array(t);var f,l,m,h,p,y=0;for(i=0;i<a;++i){for(f=t,o=s-1;-1!==o;--o)for(u=e[i][o],f-=u[0].length,m=u.length-1;-1!==m;--m)for(p=u[m],l=c[y+m],h=p.length-1;-1!==h;--h)l[f+h]=p[h];y+=e[i][0].length}return c},numeric.tensor=function(e,r){if("number"==typeof e||"number"==typeof r)return numeric.mul(e,r);var n=numeric.dim(e),t=numeric.dim(r);if(1!==n.length||1!==t.length)throw new Error("numeric: tensor product is only defined for vectors");var i,o,u,a,s=n[0],c=t[0],f=Array(s);for(o=s-1;o>=0;o--){for(i=Array(c),a=e[o],u=c-1;u>=3;--u)i[u]=a*r[u],--u,i[u]=a*r[u],--u,i[u]=a*r[u],--u,i[u]=a*r[u];for(;u>=0;)i[u]=a*r[u],--u;f[o]=i}return f},numeric.T=function(e,r){this.x=e,this.y=r},numeric.t=function(e,r){return new numeric.T(e,r)},numeric.Tbinop=function(e,r,n,t,i){numeric.indexOf;if("string"!=typeof i){var o;i="";for(o in numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||r.indexOf(o)>=0||n.indexOf(o)>=0||t.indexOf(o)>=0)&&o.length>1&&(i+="var "+o+" = numeric."+o+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+t+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+r+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,r=numeric.div;if(this.y){var n=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(r(this.x,n),r(numeric.neg(this.y),n))}return new T(r(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var r=numeric.div;return this.y?new numeric.T(r(this.x,e.x),r(this.y,e.x)):new numeric.T(r(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,r=this.x,n=this.y;return n?new numeric.T(e(r),e(n)):new numeric.T(e(r))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,r=this.x,n=this.y;return n?new numeric.T(e(r),numeric.negtranspose(n)):new numeric.T(e(r))},numeric.Tunop=function(e,r,n){return"string"!=typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+r+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if(void 0===e.y)return new numeric.T(numeric.inv(e.x));var r,n,t,i,o,u,a,s,c,f,l,r,n,t,m,h,p,y,g,d,v,_=e.x.length,b=numeric.identity(_),x=numeric.rep([_,_],0),w=numeric.clone(e.x),k=numeric.clone(e.y);for(r=0;r<_;r++){for(p=w[r][r],y=k[r][r],m=p*p+y*y,t=r,n=r+1;n<_;n++)p=w[n][r],y=k[n][r],(h=p*p+y*y)>m&&(t=n,m=h);for(t!==r&&(v=w[r],w[r]=w[t],w[t]=v,v=k[r],k[r]=k[t],k[t]=v,v=b[r],b[r]=b[t],b[t]=v,v=x[r],x[r]=x[t],x[t]=v),i=w[r],o=k[r],s=b[r],c=x[r],p=i[r],y=o[r],n=r+1;n<_;n++)g=i[n],d=o[n],i[n]=(g*p+d*y)/m,o[n]=(d*p-g*y)/m;for(n=0;n<_;n++)g=s[n],d=c[n],s[n]=(g*p+d*y)/m,c[n]=(d*p-g*y)/m;for(n=r+1;n<_;n++){for(u=w[n],a=k[n],f=b[n],l=x[n],p=u[r],y=a[r],t=r+1;t<_;t++)g=i[t],d=o[t],u[t]-=g*p-d*y,a[t]-=d*p+g*y;for(t=0;t<_;t++)g=s[t],d=c[t],f[t]-=g*p-d*y,l[t]-=d*p+g*y}}for(r=_-1;r>0;r--)for(s=b[r],c=x[r],n=r-1;n>=0;n--)for(f=b[n],l=x[n],p=w[n][r],y=k[n][r],t=_-1;t>=0;t--)g=s[t],d=c[t],f[t]-=p*g-y*d,l[t]-=p*d+y*g;return new numeric.T(b,x)},numeric.T.prototype.get=function(e){var r,n=this.x,t=this.y,i=0,o=e.length;if(t){for(;i<o;)r=e[i],n=n[r],t=t[r],i++;return new numeric.T(n,t)}for(;i<o;)r=e[i],n=n[r],i++;return new numeric.T(n)},numeric.T.prototype.set=function(e,r){var n,t=this.x,i=this.y,o=0,u=e.length,a=r.x,s=r.y;if(0===u)return s?this.y=s:i&&(this.y=void 0),this.x=t,this;if(s){for(i||(i=numeric.rep(numeric.dim(t),0),this.y=i);o<u-1;)n=e[o],t=t[n],i=i[n],o++;return n=e[o],t[n]=a,i[n]=s,this}if(i){for(;o<u-1;)n=e[o],t=t[n],i=i[n],o++;return n=e[o],t[n]=a,a instanceof Array?i[n]=numeric.rep(numeric.dim(a),0):i[n]=0,this}for(;o<u-1;)n=e[o],t=t[n],o++;return n=e[o],t[n]=a,this},numeric.T.prototype.getRows=function(e,r){var n,t,i=r-e+1,o=Array(i),u=this.x,a=this.y;for(n=e;n<=r;n++)o[n-e]=u[n];if(a){for(t=Array(i),n=e;n<=r;n++)t[n-e]=a[n];return new numeric.T(o,t)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,r,n){var t,i=this.x,o=this.y,u=n.x,a=n.y;for(t=e;t<=r;t++)i[t]=u[t-e];if(a)for(o||(o=numeric.rep(numeric.dim(i),0),this.y=o),t=e;t<=r;t++)o[t]=a[t-e];else if(o)for(t=e;t<=r;t++)o[t]=numeric.rep([u[t-e].length],0);return this},numeric.T.prototype.getRow=function(e){var r=this.x,n=this.y;return n?new numeric.T(r[e],n[e]):new numeric.T(r[e])},numeric.T.prototype.setRow=function(e,r){var n=this.x,t=this.y,i=r.x,o=r.y;return n[e]=i,o?(t||(t=numeric.rep(numeric.dim(n),0),this.y=t),t[e]=o):t&&(t=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,r){var n=this.x,t=this.y,i=numeric.getBlock;return t?new numeric.T(i(n,e,r),i(t,e,r)):new numeric.T(i(n,e,r))},numeric.T.prototype.setBlock=function(e,r,n){n instanceof numeric.T||(n=new numeric.T(n));var t=this.x,i=this.y,o=numeric.setBlock,u=n.x,a=n.y;if(a)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),o(t,e,r,u),o(i,e,r,a),this;o(t,e,r,u),i&&o(i,e,r,numeric.rep(numeric.dim(u),0))},numeric.T.rep=function(e,r){var n=numeric.T;r instanceof n||(r=new n(r));var t=r.x,i=r.y,o=numeric.rep;return i?new n(o(e,t),o(e,i)):new n(o(e,t))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var r=e.x,n=e.y,t=numeric.diag;return n?new numeric.T(t(r),t(n)):new numeric.T(t(r))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,r=this.x,n=this.y;return n?new e.T(e.getDiag(r),e.getDiag(n)):new e.T(e.getDiag(r))},numeric.house=function(e){var r=numeric.clone(e),n=e[0]>=0?1:-1,t=n*numeric.norm2(e);r[0]+=t;var i=numeric.norm2(r);if(0===i)throw new Error("eig: internal error");return numeric.div(r,i)},numeric.toUpperHessenberg=function(e){var r=numeric.dim(e);if(2!==r.length||r[0]!==r[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var n,t,i,o,u,a,s,c,f,l,m=r[0],h=numeric.clone(e),p=numeric.identity(m);for(t=0;t<m-2;t++){for(o=Array(m-t-1),n=t+1;n<m;n++)o[n-t-1]=h[n][t];if(numeric.norm2(o)>0){for(u=numeric.house(o),a=numeric.getBlock(h,[t+1,t],[m-1,m-1]),s=numeric.tensor(u,numeric.dot(u,a)),n=t+1;n<m;n++)for(c=h[n],f=s[n-t-1],i=t;i<m;i++)c[i]-=2*f[i-t];for(a=numeric.getBlock(h,[0,t+1],[m-1,m-1]),s=numeric.tensor(numeric.dot(a,u),u),n=0;n<m;n++)for(c=h[n],f=s[n],i=t+1;i<m;i++)c[i]-=2*f[i-t-1];for(a=Array(m-t-1),n=t+1;n<m;n++)a[n-t-1]=p[n];for(s=numeric.tensor(u,numeric.dot(u,a)),n=t+1;n<m;n++)for(l=p[n],f=s[n-t-1],i=0;i<m;i++)l[i]-=2*f[i]}}return{H:h,Q:p}},numeric.epsilon=2.220446049250313e-16,numeric.QRFrancis=function(e,r){void 0===r&&(r=1e4),e=numeric.clone(e);var n,t,i,o,u,a,s,c,f,l,m,h,p,y,g,d,v,_,b=(numeric.clone(e),numeric.dim(e)),x=b[0],w=numeric.identity(x);if(x<3)return{Q:w,B:[[0,x-1]]};var k=numeric.epsilon;for(_=0;_<r;_++){for(d=0;d<x-1;d++)if(Math.abs(e[d+1][d])<k*(Math.abs(e[d][d])+Math.abs(e[d+1][d+1]))){var T=numeric.QRFrancis(numeric.getBlock(e,[0,0],[d,d]),r),M=numeric.QRFrancis(numeric.getBlock(e,[d+1,d+1],[x-1,x-1]),r);for(h=Array(d+1),g=0;g<=d;g++)h[g]=w[g];for(p=numeric.dot(T.Q,h),g=0;g<=d;g++)w[g]=p[g];for(h=Array(x-d-1),g=d+1;g<x;g++)h[g-d-1]=w[g];for(p=numeric.dot(M.Q,h),
g=d+1;g<x;g++)w[g]=p[g-d-1];return{Q:w,B:T.B.concat(numeric.add(M.B,d+1))}}if(i=e[x-2][x-2],o=e[x-2][x-1],u=e[x-1][x-2],a=e[x-1][x-1],c=i+a,s=i*a-o*u,f=numeric.getBlock(e,[0,0],[2,2]),c*c>=4*s){var C,S;C=.5*(c+Math.sqrt(c*c-4*s)),S=.5*(c-Math.sqrt(c*c-4*s)),f=numeric.add(numeric.sub(numeric.dot(f,f),numeric.mul(f,C+S)),numeric.diag(numeric.rep([3],C*S)))}else f=numeric.add(numeric.sub(numeric.dot(f,f),numeric.mul(f,c)),numeric.diag(numeric.rep([3],s)));for(n=[f[0][0],f[1][0],f[2][0]],t=numeric.house(n),h=[e[0],e[1],e[2]],p=numeric.tensor(t,numeric.dot(t,h)),g=0;g<3;g++)for(m=e[g],y=p[g],v=0;v<x;v++)m[v]-=2*y[v];for(h=numeric.getBlock(e,[0,0],[x-1,2]),p=numeric.tensor(numeric.dot(h,t),t),g=0;g<x;g++)for(m=e[g],y=p[g],v=0;v<3;v++)m[v]-=2*y[v];for(h=[w[0],w[1],w[2]],p=numeric.tensor(t,numeric.dot(t,h)),g=0;g<3;g++)for(l=w[g],y=p[g],v=0;v<x;v++)l[v]-=2*y[v];var P;for(d=0;d<x-2;d++){for(v=d;v<=d+1;v++)if(Math.abs(e[v+1][v])<k*(Math.abs(e[v][v])+Math.abs(e[v+1][v+1]))){var T=numeric.QRFrancis(numeric.getBlock(e,[0,0],[v,v]),r),M=numeric.QRFrancis(numeric.getBlock(e,[v+1,v+1],[x-1,x-1]),r);for(h=Array(v+1),g=0;g<=v;g++)h[g]=w[g];for(p=numeric.dot(T.Q,h),g=0;g<=v;g++)w[g]=p[g];for(h=Array(x-v-1),g=v+1;g<x;g++)h[g-v-1]=w[g];for(p=numeric.dot(M.Q,h),g=v+1;g<x;g++)w[g]=p[g-v-1];return{Q:w,B:T.B.concat(numeric.add(M.B,v+1))}}for(P=Math.min(x-1,d+3),n=Array(P-d),g=d+1;g<=P;g++)n[g-d-1]=e[g][d];for(t=numeric.house(n),h=numeric.getBlock(e,[d+1,d],[P,x-1]),p=numeric.tensor(t,numeric.dot(t,h)),g=d+1;g<=P;g++)for(m=e[g],y=p[g-d-1],v=d;v<x;v++)m[v]-=2*y[v-d];for(h=numeric.getBlock(e,[0,d+1],[x-1,P]),p=numeric.tensor(numeric.dot(h,t),t),g=0;g<x;g++)for(m=e[g],y=p[g],v=d+1;v<=P;v++)m[v]-=2*y[v-d-1];for(h=Array(P-d),g=d+1;g<=P;g++)h[g-d-1]=w[g];for(p=numeric.tensor(t,numeric.dot(t,h)),g=d+1;g<=P;g++)for(l=w[g],y=p[g-d-1],v=0;v<x;v++)l[v]-=2*y[v]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,r){var n,t,i,o,u,a,s,c,f,l,m,h,p,y,g,d,v,_=numeric.toUpperHessenberg(e),b=numeric.QRFrancis(_.H,r),x=numeric.T,w=e.length,k=b.B,T=numeric.dot(b.Q,numeric.dot(_.H,numeric.transpose(b.Q))),M=new x(numeric.dot(b.Q,_.Q)),C=k.length,S=Math.sqrt;for(t=0;t<C;t++)if((n=k[t][0])!==k[t][1]){if(o=n+1,u=T[n][n],a=T[n][o],s=T[o][n],c=T[o][o],0===a&&0===s)continue;f=-u-c,l=u*c-a*s,m=f*f-4*l,m>=0?(h=f<0?-.5*(f-S(m)):-.5*(f+S(m)),d=(u-h)*(u-h)+a*a,v=s*s+(c-h)*(c-h),d>v?(d=S(d),y=(u-h)/d,g=a/d):(v=S(v),y=s/v,g=(c-h)/v),i=new x([[g,-y],[y,g]]),M.setRows(n,o,i.dot(M.getRows(n,o)))):(h=-.5*f,p=.5*S(-m),d=(u-h)*(u-h)+a*a,v=s*s+(c-h)*(c-h),d>v?(d=S(d+p*p),y=(u-h)/d,g=a/d,h=0,p/=d):(v=S(v+p*p),y=s/v,g=(c-h)/v,h=p/v,p=0),i=new x([[g,-y],[y,g]],[[h,p],[p,-h]]),M.setRows(n,o,i.dot(M.getRows(n,o))))}var P=M.dot(e).dot(M.transjugate()),w=e.length,A=numeric.T.identity(w);for(o=0;o<w;o++)if(o>0)for(t=o-1;t>=0;t--){var j=P.get([t,t]),O=P.get([o,o]);numeric.neq(j.x,O.x)||numeric.neq(j.y,O.y)?(h=P.getRow(t).getBlock([t],[o-1]),p=A.getRow(o).getBlock([t],[o-1]),A.set([o,t],P.get([t,o]).neg().sub(h.dot(p)).div(j.sub(O)))):A.setRow(o,A.getRow(t))}for(o=0;o<w;o++)h=A.getRow(o),A.setRow(o,h.div(h.norm2()));return A=A.transpose(),A=M.transjugate().dot(A),{lambda:P.getDiag(),E:A}},numeric.ccsSparse=function(e){var r,n,t,i,o=e.length,u=[];for(t=o-1;-1!==t;--t){n=e[t];for(i in n){for(i=parseInt(i);i>=u.length;)u[u.length]=0;0!==n[i]&&u[i]++}}var r=u.length,a=Array(r+1);for(a[0]=0,t=0;t<r;++t)a[t+1]=a[t]+u[t];var s=Array(a[r]),c=Array(a[r]);for(t=o-1;-1!==t;--t){n=e[t];for(i in n)0!==n[i]&&(u[i]--,s[a[i]+u[i]]=t,c[a[i]+u[i]]=n[i])}return[a,s,c]},numeric.ccsFull=function(e){var r,n,t,i,o=e[0],u=e[1],a=e[2],s=numeric.ccsDim(e),c=s[0],f=s[1],l=numeric.rep([c,f],0);for(r=0;r<f;r++)for(t=o[r],i=o[r+1],n=t;n<i;++n)l[u[n]][r]=a[n];return l},numeric.ccsTSolve=function(e,r,n,t,i){function o(e){var r;if(0===n[e]){for(n[e]=1,r=u[e];r<u[e+1];++r)o(a[r]);i[l]=e,++l}}var u=e[0],a=e[1],s=e[2],c=u.length-1,f=Math.max,l=0;void 0===t&&(n=numeric.rep([c],0)),void 0===t&&(t=numeric.linspace(0,n.length-1)),void 0===i&&(i=[]);var m,h,p,y,g,d,v;for(m=t.length-1;-1!==m;--m)o(t[m]);for(i.length=l,m=i.length-1;-1!==m;--m)n[i[m]]=0;for(m=t.length-1;-1!==m;--m)h=t[m],n[h]=r[h];for(m=i.length-1;-1!==m;--m){for(h=i[m],p=u[h],y=f(u[h+1],p),g=p;g!==y;++g)if(a[g]===h){n[h]/=s[g];break}for(v=n[h],g=p;g!==y;++g)(d=a[g])!==h&&(n[d]-=v*s[g])}return n},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,r,n,t,i,o){var u,a,s,c=0,f=i.length,l=this.k,m=this.k1,h=this.j;if(0===t[e])for(t[e]=1,h[0]=e,l[0]=a=r[e],m[0]=s=r[e+1];;)if(a>=s){if(i[f]=h[c],0===c)return;++f,--c,a=l[c],s=m[c]}else u=o[n[a]],0===t[u]?(t[u]=1,l[c]=a,++c,h[c]=u,a=r[u],m[c]=s=r[u+1]):++a},numeric.ccsLPSolve=function(e,r,n,t,i,o,u){var a,s,c,f,l,m,h,p,y,g=e[0],d=e[1],v=e[2],_=(g.length,r[0]),b=r[1],x=r[2];for(s=_[i],c=_[i+1],t.length=0,a=s;a<c;++a)u.dfs(o[b[a]],g,d,n,t,o);for(a=t.length-1;-1!==a;--a)n[t[a]]=0;for(a=s;a!==c;++a)f=o[b[a]],n[f]=x[a];for(a=t.length-1;-1!==a;--a){for(f=t[a],l=g[f],m=g[f+1],h=l;h<m;++h)if(o[d[h]]===f){n[f]/=v[h];break}for(y=n[f],h=l;h<m;++h)(p=o[d[h]])!==f&&(n[p]-=y*v[h])}return n},numeric.ccsLUP1=function(e,r){var n,t,i,o,u,a,s,c=e[0].length-1,f=[numeric.rep([c+1],0),[],[]],l=[numeric.rep([c+1],0),[],[]],m=f[0],h=f[1],p=f[2],y=l[0],g=l[1],d=l[2],v=numeric.rep([c],0),_=numeric.rep([c],0),b=numeric.ccsLPSolve,x=(Math.max,Math.abs),w=numeric.linspace(0,c-1),k=numeric.linspace(0,c-1),T=new numeric.ccsDFS(c);for(void 0===r&&(r=1),n=0;n<c;++n){for(b(f,e,v,_,n,k,T),o=-1,u=-1,t=_.length-1;-1!==t;--t)(i=_[t])<=n||(a=x(v[i]))>o&&(u=i,o=a);for(x(v[n])<r*o&&(t=w[n],o=w[u],w[n]=o,k[o]=n,w[u]=t,k[t]=u,o=v[n],v[n]=v[u],v[u]=o),o=m[n],u=y[n],s=v[n],h[o]=w[n],p[o]=1,++o,t=_.length-1;-1!==t;--t)i=_[t],a=v[i],_[t]=0,v[i]=0,i<=n?(g[u]=i,d[u]=a,++u):(h[o]=w[i],p[o]=a/s,++o);m[n+1]=o,y[n+1]=u}for(t=h.length-1;-1!==t;--t)h[t]=k[h[t]];return{L:f,U:l,P:w,Pinv:k}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,r,n,t,i,o,u){var a,s,c,f=0,l=i.length,m=this.k,h=this.k1,p=this.j;if(0===t[e])for(t[e]=1,p[0]=e,m[0]=s=r[o[e]],h[0]=c=r[o[e]+1];;){if(isNaN(s))throw new Error("Ow!");if(s>=c){if(i[l]=o[p[f]],0===f)return;++l,--f,s=m[f],c=h[f]}else a=n[s],0===t[a]?(t[a]=1,m[f]=s,++f,p[f]=a,a=o[a],s=r[a],h[f]=c=r[a+1]):++s}},numeric.ccsLPSolve0=function(e,r,n,t,i,o,u,a){var s,c,f,l,m,h,p,y,g,d=e[0],v=e[1],_=e[2],b=(d.length,r[0]),x=r[1],w=r[2];for(c=b[i],f=b[i+1],t.length=0,s=c;s<f;++s)a.dfs(x[s],d,v,n,t,o,u);for(s=t.length-1;-1!==s;--s)l=t[s],n[u[l]]=0;for(s=c;s!==f;++s)l=x[s],n[l]=w[s];for(s=t.length-1;-1!==s;--s){for(l=t[s],y=u[l],m=d[l],h=d[l+1],p=m;p<h;++p)if(v[p]===y){n[y]/=_[p];break}for(g=n[y],p=m;p<h;++p)n[v[p]]-=g*_[p];n[y]=g}},numeric.ccsLUP0=function(e,r){var n,t,i,o,u,a,s,c=e[0].length-1,f=[numeric.rep([c+1],0),[],[]],l=[numeric.rep([c+1],0),[],[]],m=f[0],h=f[1],p=f[2],y=l[0],g=l[1],d=l[2],v=numeric.rep([c],0),_=numeric.rep([c],0),b=numeric.ccsLPSolve0,x=(Math.max,Math.abs),w=numeric.linspace(0,c-1),k=numeric.linspace(0,c-1),T=new numeric.ccsDFS0(c);for(void 0===r&&(r=1),n=0;n<c;++n){for(b(f,e,v,_,n,k,w,T),o=-1,u=-1,t=_.length-1;-1!==t;--t)(i=_[t])<=n||(a=x(v[w[i]]))>o&&(u=i,o=a);for(x(v[w[n]])<r*o&&(t=w[n],o=w[u],w[n]=o,k[o]=n,w[u]=t,k[t]=u),o=m[n],u=y[n],s=v[w[n]],h[o]=w[n],p[o]=1,++o,t=_.length-1;-1!==t;--t)i=_[t],a=v[w[i]],_[t]=0,v[w[i]]=0,i<=n?(g[u]=i,d[u]=a,++u):(h[o]=w[i],p[o]=a/s,++o);m[n+1]=o,y[n+1]=u}for(t=h.length-1;-1!==t;--t)h[t]=k[h[t]];return{L:f,U:l,P:w,Pinv:k}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,r,n){var t=numeric.ccsDim(e),i=t[0],o=t[1];void 0===r?r=numeric.linspace(0,i-1):"number"==typeof r&&(r=[r]),void 0===n?n=numeric.linspace(0,o-1):"number"==typeof n&&(n=[n]);var u,a,s,c,f,l=r.length,m=n.length,h=numeric.rep([o],0),p=[],y=[],g=[h,p,y],d=e[0],v=e[1],_=e[2],b=numeric.rep([i],0),x=0,w=numeric.rep([i],0);for(a=0;a<m;++a){c=n[a];var k=d[c],T=d[c+1];for(u=k;u<T;++u)s=v[u],w[s]=1,b[s]=_[u];for(u=0;u<l;++u)f=r[u],w[f]&&(p[x]=u,y[x]=b[r[u]],++x);for(u=k;u<T;++u)s=v[u],w[s]=0;h[a+1]=x}return g},numeric.ccsDot=function(e,r){var n,t,i,o,u,a,s,c,f,l,m,h=e[0],p=e[1],y=e[2],g=r[0],d=r[1],v=r[2],_=numeric.ccsDim(e),b=numeric.ccsDim(r),x=_[0],w=(_[1],b[1]),k=numeric.rep([x],0),T=numeric.rep([x],0),M=Array(x),C=numeric.rep([w],0),S=[],P=[],A=[C,S,P];for(i=0;i!==w;++i){for(o=g[i],u=g[i+1],f=0,t=o;t<u;++t)for(l=d[t],m=v[t],a=h[l],s=h[l+1],n=a;n<s;++n)c=p[n],0===T[c]&&(M[f]=c,T[c]=1,f+=1),k[c]=k[c]+y[n]*m;for(o=C[i],u=o+f,C[i+1]=u,t=f-1;-1!==t;--t)m=o+t,n=M[t],S[m]=n,P[m]=k[n],T[n]=0,k[n]=0;C[i+1]=C[i]+f}return A},numeric.ccsLUPSolve=function(e,r){var n=e.L,t=e.U,i=(e.P,r[0]),o=!1;"object"!=(void 0===i?"undefined":_typeof(i))&&(r=[[0,r.length],numeric.linspace(0,r.length-1),r],i=r[0],o=!0);var u,a,s,c,f,l,m=r[1],h=r[2],p=n[0].length-1,y=i.length-1,g=numeric.rep([p],0),d=Array(p),v=numeric.rep([p],0),_=Array(p),b=numeric.rep([y+1],0),x=[],w=[],k=numeric.ccsTSolve,T=0;for(u=0;u<y;++u){for(f=0,s=i[u],c=i[u+1],a=s;a<c;++a)l=e.Pinv[m[a]],_[f]=l,v[l]=h[a],++f;for(_.length=f,k(n,v,g,_,d),a=_.length-1;-1!==a;--a)v[_[a]]=0;if(k(t,g,v,d,_),o)return v;for(a=d.length-1;-1!==a;--a)g[d[a]]=0;for(a=_.length-1;-1!==a;--a)l=_[a],x[T]=l,w[T]=v[l],v[l]=0,++T;b[u+1]=T}return[b,x,w]},numeric.ccsbinop=function(e,r){return void 0===r&&(r=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+r+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var r,n=e[0],t=e[1],i=e[2],o=numeric.sup(t)+1,u=n.length,a=numeric.rep([o],0),s=Array(u),c=Array(u),f=numeric.rep([o],0);for(r=0;r<u;++r)f[t[r]]++;for(r=0;r<o;++r)a[r+1]=a[r]+f[r];var l,m,h=a.slice(0);for(r=0;r<u;++r)m=t[r],l=h[m],s[l]=n[r],c[l]=i[r],h[m]=h[m]+1;return[a,s,c]},numeric.ccsGather=function(e){var r,n,t,i,o,u=e[0],a=e[1],s=e[2],c=u.length-1,f=a.length,l=Array(f),m=Array(f),h=Array(f);for(o=0,r=0;r<c;++r)for(t=u[r],i=u[r+1],n=t;n!==i;++n)m[o]=r,l[o]=a[n],h[o]=s[n],++o;return[l,m,h]},numeric.sdim=function e(r,n,t){if(void 0===n&&(n=[]),"object"!=(void 0===r?"undefined":_typeof(r)))return n;void 0===t&&(t=0),t in n||(n[t]=0),r.length>n[t]&&(n[t]=r.length);var i;for(i in r)r.hasOwnProperty(i)&&e(r[i],n,t+1);return n},numeric.sclone=function e(r,n,t){void 0===n&&(n=0),void 0===t&&(t=numeric.sdim(r).length);var i,o=Array(r.length);if(n===t-1){for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);return o}for(i in r)r.hasOwnProperty(i)&&(o[i]=e(r[i],n+1,t));return o},numeric.sdiag=function(e){var r,n,t=e.length,i=Array(t);for(r=t-1;r>=1;r-=2)n=r-1,i[r]=[],i[r][r]=e[r],i[n]=[],i[n][n]=e[n];return 0===r&&(i[0]=[],i[0][0]=e[r]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var r,n,t,i=[];e.length;for(r in e)if(e.hasOwnProperty(r)){t=e[r];for(n in t)t.hasOwnProperty(n)&&("object"!=_typeof(i[n])&&(i[n]=[]),i[n][r]=t[n])}return i},numeric.sLUP=function(e,r){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,r){var n,t,i,o,u,a,s,c=e.length,f=(r.length,numeric.stranspose(r)),l=f.length,m=Array(c);for(i=c-1;i>=0;i--){for(s=[],n=e[i],u=l-1;u>=0;u--){a=0,t=f[u];for(o in n)n.hasOwnProperty(o)&&o in t&&(a+=n[o]*t[o]);a&&(s[u]=a)}m[i]=s}return m},numeric.sdotMV=function(e,r){var n,t,i,o,u=e.length,a=Array(u);for(t=u-1;t>=0;t--){n=e[t],o=0;for(i in n)n.hasOwnProperty(i)&&r[i]&&(o+=n[i]*r[i]);o&&(a[t]=o)}return a},numeric.sdotVM=function(e,r){var n,t,i,o,u=[];for(n in e)if(e.hasOwnProperty(n)){i=r[n],o=e[n];for(t in i)i.hasOwnProperty(t)&&(u[t]||(u[t]=0),u[t]+=o*i[t])}return u},numeric.sdotVV=function(e,r){var n,t=0;for(n in e)e[n]&&r[n]&&(t+=e[n]*r[n]);return t},numeric.sdot=function(e,r){var n=numeric.sdim(e).length,t=numeric.sdim(r).length;switch(1e3*n+t){case 0:return e*r;case 1001:return numeric.sdotVV(e,r);case 2001:return numeric.sdotMV(e,r);case 1002:return numeric.sdotVM(e,r);case 2002:return numeric.sdotMM(e,r);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+t)}},numeric.sscatter=function(e){var r,n,t,i,o=e[0].length,u=e.length,a=[];for(n=o-1;n>=0;--n)if(e[u-1][n]){for(i=a,t=0;t<u-2;t++)r=e[t][n],i[r]||(i[r]=[]),i=i[r];i[e[t][n]]=e[t+1][n]}return a},numeric.sgather=function e(r,n,t){void 0===n&&(n=[]),void 0===t&&(t=[]);var i,o,u;i=t.length;for(o in r)if(r.hasOwnProperty(o))if(t[i]=parseInt(o),"number"==typeof(u=r[o])){if(u){if(0===n.length)for(o=i+1;o>=0;--o)n[o]=[];for(o=i;o>=0;--o)n[o].push(t[o]);n[i+1].push(u)}}else e(u,n,t);return t.length>i&&t.pop(),n},numeric.cLU=function(e){var r,n,t,i,o,u,a=e[0],s=e[1],c=e[2],f=a.length,l=0;for(r=0;r<f;r++)a[r]>l&&(l=a[r]);l++;var m,h,p,y=Array(l),g=Array(l),d=numeric.rep([l],1/0),v=numeric.rep([l],-1/0);for(t=0;t<f;t++)r=a[t],n=s[t],n<d[r]&&(d[r]=n),n>v[r]&&(v[r]=n);for(r=0;r<l-1;r++)v[r]>v[r+1]&&(v[r+1]=v[r]);for(r=l-1;r>=1;r--)d[r]<d[r-1]&&(d[r-1]=d[r]);var _=0,b=0;for(r=0;r<l;r++)g[r]=numeric.rep([v[r]-d[r]+1],0),y[r]=numeric.rep([r-d[r]],0),_+=r-d[r]+1,b+=v[r]-r+1;for(t=0;t<f;t++)r=a[t],g[r][s[t]-d[r]]=c[t];for(r=0;r<l-1;r++)for(i=r-d[r],m=g[r],n=r+1;d[n]<=r&&n<l;n++)if(o=r-d[n],u=v[r]-r,h=g[n],p=h[o]/m[i],p){for(t=1;t<=u;t++)h[t+o]-=p*m[t+i];y[n][r-d[n]]=p}var f,x,w,m=[],h=[],k=[],T=[],M=[],C=[];for(f=0,x=0,r=0;r<l;r++){for(i=d[r],o=v[r],w=g[r],n=r;n<=o;n++)w[n-i]&&(m[f]=r,h[f]=n,k[f]=w[n-i],f++);for(w=y[r],n=i;n<r;n++)w[n-i]&&(T[x]=r,M[x]=n,C[x]=w[n-i],x++);T[x]=r,M[x]=r,C[x]=1,x++}return{U:[m,h,k],L:[T,M,C]}},numeric.cLUsolve=function(e,r){var n,t,i=e.L,o=e.U,u=numeric.clone(r),a=i[0],s=i[1],c=i[2],f=o[0],l=o[1],m=o[2],h=f.length,p=(a.length,u.length);for(t=0,n=0;n<p;n++){for(;s[t]<n;)u[n]-=c[t]*u[s[t]],t++;t++}for(t=h-1,n=p-1;n>=0;n--){for(;l[t]>n;)u[n]-=m[t]*u[l[t]],t--;u[n]/=m[t],t--}return u},numeric.cgrid=function(e,r){"number"==typeof e&&(e=[e,e]);var n,t,i,o=numeric.rep(e,-1);if("function"!=typeof r)switch(r){case"L":r=function(r,n){return r>=e[0]/2||n<e[1]/2};break;default:r=function(e,r){return!0}}for(i=0,n=1;n<e[0]-1;n++)for(t=1;t<e[1]-1;t++)r(n,t)&&(o[n][t]=i,i++);return o},numeric.cdelsq=function(e){var r,n,t,i,o,u=[[-1,0],[0,-1],[0,1],[1,0]],a=numeric.dim(e),s=a[0],c=a[1],f=[],l=[],m=[];for(r=1;r<s-1;r++)for(n=1;n<c-1;n++)if(!(e[r][n]<0)){for(t=0;t<4;t++)i=r+u[t][0],o=n+u[t][1],e[i][o]<0||(f.push(e[r][n]),l.push(e[i][o]),m.push(-1));f.push(e[r][n]),l.push(e[r][n]),m.push(4)}return[f,l,m]},numeric.cdotMV=function(e,r){var n,t,i,o=e[0],u=e[1],a=e[2],s=o.length;for(i=0,t=0;t<s;t++)o[t]>i&&(i=o[t]);for(i++,n=numeric.rep([i],0),t=0;t<s;t++)n[o[t]]+=a[t]*r[u[t]];return n},numeric.Spline=function(e,r,n,t,i){this.x=e,this.yl=r,this.yr=n,this.kl=t,this.kr=i},numeric.Spline.prototype._at=function(e,r){var e,n,t,i,o=this.x,u=this.yl,a=this.yr,s=this.kl,c=this.kr,f=numeric.add,l=numeric.sub,m=numeric.mul;n=l(m(s[r],o[r+1]-o[r]),l(a[r+1],u[r])),t=f(m(c[r+1],o[r]-o[r+1]),l(a[r+1],u[r])),i=(e-o[r])/(o[r+1]-o[r]);var h=i*(1-i);return f(f(f(m(1-i,u[r]),m(i,a[r+1])),m(n,h*(1-i))),m(t,h*i))},numeric.Spline.prototype.at=function(e){if("number"==typeof e){var r,n,t,i=this.x,o=i.length,u=Math.floor;for(r=0,n=o-1;n-r>1;)t=u((r+n)/2),i[t]<=e?r=t:n=t;return this._at(e,r)}var a,o=e.length,s=Array(o);for(a=o-1;-1!==a;--a)s[a]=this.at(e[a]);return s},numeric.Spline.prototype.diff=function(){var e,r,n,t=this.x,i=this.yl,o=this.yr,u=this.kl,a=this.kr,s=i.length,c=u,f=a,l=Array(s),m=Array(s),h=numeric.add,p=numeric.mul,y=numeric.div,g=numeric.sub;for(e=s-1;-1!==e;--e)r=t[e+1]-t[e],n=g(o[e+1],i[e]),l[e]=y(h(p(n,6),p(u[e],-4*r),p(a[e+1],-2*r)),r*r),m[e+1]=y(h(p(n,-6),p(u[e],2*r),p(a[e+1],4*r)),r*r);return new numeric.Spline(t,c,f,l,m)},numeric.Spline.prototype.roots=function(){var e=[],r=this.x,n=this.yl,t=this.yr,i=this.kl,o=this.kr;"number"==typeof n[0]&&(n=[n],t=[t],i=[i],o=[o]);var u,a,s,c,f,l,m,h,p,y,g,d,v,_,b,x,w,k,T,M,C,S,P,A=n.length,j=r.length-1,e=Array(A),O=Math.sqrt;for(u=0;u!==A;++u){for(c=n[u],f=t[u],l=i[u],m=o[u],h=[],a=0;a!==j;a++){for(a>0&&f[a]*c[a]<0&&h.push(r[a]),x=r[a+1]-r[a],r[a],g=c[a],d=f[a+1],p=l[a]/x,y=m[a+1]/x,b=function(e){return e*e}(p-y+3*(g-d))+12*y*g,v=y+3*g+2*p-3*d,_=3*(y+p+2*(g-d)),b<=0?(k=v/_,w=k>r[a]&&k<r[a+1]?[r[a],k,r[a+1]]:[r[a],r[a+1]]):(k=(v-O(b))/_,T=(v+O(b))/_,w=[r[a]],k>r[a]&&k<r[a+1]&&w.push(k),T>r[a]&&T<r[a+1]&&w.push(T),w.push(r[a+1])),C=w[0],k=this._at(C,a),s=0;s<w.length-1;s++)if(S=w[s+1],T=this._at(S,a),0!==k)if(0===T||k*T>0)C=S,k=T;else{for(var D=0;!((P=(k*S-T*C)/(k-T))<=C||P>=S);)if((M=this._at(P,a))*T>0)S=P,T=M,-1===D&&(k*=.5),D=-1;else{if(!(M*k>0))break;C=P,k=M,1===D&&(T*=.5),D=1}h.push(P),C=w[s+1],k=this._at(C,a)}else h.push(C),C=S,k=T;0===T&&h.push(S)}e[u]=h}return"number"==typeof this.yl[0]?e[0]:e},numeric.spline=function(e,r,n,t){var i,o=e.length,u=[],a=[],s=[],c=numeric.sub,f=numeric.mul,l=numeric.add;for(i=o-2;i>=0;i--)a[i]=e[i+1]-e[i],s[i]=c(r[i+1],r[i]);"string"!=typeof n&&"string"!=typeof t||(n=t="periodic");var m=[[],[],[]];switch(void 0===n?"undefined":_typeof(n)){case"undefined":u[0]=f(3/(a[0]*a[0]),s[0]),m[0].push(0,0),m[1].push(0,1),m[2].push(2/a[0],1/a[0]);break;case"string":u[0]=l(f(3/(a[o-2]*a[o-2]),s[o-2]),f(3/(a[0]*a[0]),s[0])),m[0].push(0,0,0),m[1].push(o-2,0,1),m[2].push(1/a[o-2],2/a[o-2]+2/a[0],1/a[0]);break;default:u[0]=n,m[0].push(0),m[1].push(0),m[2].push(1)}for(i=1;i<o-1;i++)u[i]=l(f(3/(a[i-1]*a[i-1]),s[i-1]),f(3/(a[i]*a[i]),s[i])),m[0].push(i,i,i),m[1].push(i-1,i,i+1),m[2].push(1/a[i-1],2/a[i-1]+2/a[i],1/a[i]);switch(void 0===t?"undefined":_typeof(t)){case"undefined":u[o-1]=f(3/(a[o-2]*a[o-2]),s[o-2]),m[0].push(o-1,o-1),m[1].push(o-2,o-1),m[2].push(1/a[o-2],2/a[o-2]);break;case"string":m[1][m[1].length-1]=0;break;default:u[o-1]=t,m[0].push(o-1),m[1].push(o-1),m[2].push(1)}u="number"!=typeof u[0]?numeric.transpose(u):[u];var h=Array(u.length);if("string"==typeof n)for(i=h.length-1;-1!==i;--i)h[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(m)),u[i]),h[i][o-1]=h[i][0];else for(i=h.length-1;-1!==i;--i)h[i]=numeric.cLUsolve(numeric.cLU(m),u[i]);return h="number"==typeof r[0]?h[0]:numeric.transpose(h),new numeric.Spline(e,r,r,h,h)},numeric.fftpow2=function e(r,n){var t=r.length;if(1!==t){var i,o,u=Math.cos,a=Math.sin,s=Array(t/2),c=Array(t/2),f=Array(t/2),l=Array(t/2);for(o=t/2,i=t-1;-1!==i;--i)--o,f[o]=r[i],l[o]=n[i],--i,s[o]=r[i],c[o]=n[i];e(s,c),e(f,l),o=t/2;var m,h,p,y=-6.283185307179586/t;for(i=t-1;-1!==i;--i)--o,-1===o&&(o=t/2-1),m=y*i,h=u(m),p=a(m),r[i]=s[o]+h*f[o]-p*l[o],n[i]=c[o]+h*l[o]+p*f[o]}},numeric._ifftpow2=function e(r,n){var t=r.length;if(1!==t){var i,o,u=Math.cos,a=Math.sin,s=Array(t/2),c=Array(t/2),f=Array(t/2),l=Array(t/2);for(o=t/2,i=t-1;-1!==i;--i)--o,f[o]=r[i],l[o]=n[i],--i,s[o]=r[i],c[o]=n[i];e(s,c),e(f,l),o=t/2;var m,h,p,y=6.283185307179586/t;for(i=t-1;-1!==i;--i)--o,-1===o&&(o=t/2-1),m=y*i,h=u(m),p=a(m),r[i]=s[o]+h*f[o]-p*l[o],n[i]=c[o]+h*l[o]+p*f[o]}},numeric.ifftpow2=function(e,r){numeric._ifftpow2(e,r),numeric.diveq(e,e.length),numeric.diveq(r,r.length)},numeric.convpow2=function(e,r,n,t){numeric.fftpow2(e,r),numeric.fftpow2(n,t);var i,o,u,a,s,c=e.length;for(i=c-1;-1!==i;--i)o=e[i],a=r[i],u=n[i],s=t[i],e[i]=o*u-a*s,r[i]=o*s+a*u;numeric.ifftpow2(e,r)},numeric.T.prototype.fft=function(){var e,r,n=this.x,t=this.y,i=n.length,o=Math.log,u=o(2),a=Math.ceil(o(2*i-1)/u),s=Math.pow(2,a),c=numeric.rep([s],0),f=numeric.rep([s],0),l=Math.cos,m=Math.sin,h=-3.141592653589793/i,p=numeric.rep([s],0),y=numeric.rep([s],0);Math.floor(i/2);for(e=0;e<i;e++)p[e]=n[e];if(void 0!==t)for(e=0;e<i;e++)y[e]=t[e];for(c[0]=1,e=1;e<=s/2;e++)r=h*e*e,c[e]=l(r),f[e]=m(r),c[s-e]=l(r),f[s-e]=m(r);var g=new numeric.T(p,y),d=new numeric.T(c,f);return g=g.mul(d),numeric.convpow2(g.x,g.y,numeric.clone(d.x),numeric.neg(d.y)),g=g.mul(d),g.x.length=i,g.y.length=i,g},numeric.T.prototype.ifft=function(){var e,r,n=this.x,t=this.y,i=n.length,o=Math.log,u=o(2),a=Math.ceil(o(2*i-1)/u),s=Math.pow(2,a),c=numeric.rep([s],0),f=numeric.rep([s],0),l=Math.cos,m=Math.sin,h=3.141592653589793/i,p=numeric.rep([s],0),y=numeric.rep([s],0);Math.floor(i/2);for(e=0;e<i;e++)p[e]=n[e];if(void 0!==t)for(e=0;e<i;e++)y[e]=t[e];for(c[0]=1,e=1;e<=s/2;e++)r=h*e*e,c[e]=l(r),f[e]=m(r),c[s-e]=l(r),f[s-e]=m(r);var g=new numeric.T(p,y),d=new numeric.T(c,f);return g=g.mul(d),numeric.convpow2(g.x,g.y,numeric.clone(d.x),numeric.neg(d.y)),g=g.mul(d),g.x.length=i,g.y.length=i,g.div(i)},numeric.gradient=function(e,r){var n=r.length,t=e(r);if(isNaN(t))throw new Error("gradient: f(x) is a NaN!");var i,o,u,a,s,c,f,l,m,h,p=Math.max,y=numeric.clone(r),g=Array(n),p=(numeric.div,numeric.sub,Math.max),d=Math.abs,v=Math.min,_=0;for(i=0;i<n;i++)for(var b=p(1e-6*t,1e-8);;){if(++_>20)throw new Error("Numerical gradient fails");if(y[i]=r[i]+b,o=e(y),y[i]=r[i]-b,u=e(y),y[i]=r[i],isNaN(o)||isNaN(u))b/=16;else{if(g[i]=(o-u)/(2*b),s=r[i]-b,c=r[i],f=r[i]+b,l=(o-t)/b,m=(t-u)/b,h=p(d(g[i]),d(t),d(o),d(u),d(s),d(c),d(f),1e-8),a=v(p(d(l-g[i]),d(m-g[i]),d(l-m))/h,b/h),!(a>.001))break;b/=16}}return g},numeric.uncmin=function(e,r,n,t,i,o,u){var a=numeric.gradient;void 0===u&&(u={}),void 0===n&&(n=1e-8),void 0===t&&(t=function(r){return a(e,r)}),void 0===i&&(i=1e3),r=numeric.clone(r);var s,c,f=r.length,l=e(r);if(isNaN(l))throw new Error("uncmin: f(x0) is a NaN!");var m=Math.max,h=numeric.norm2;n=m(n,numeric.epsilon);var p,y,g,d,v,_,b,x,w,k,T=u.Hinv||numeric.identity(f),M=numeric.dot,C=(numeric.inv,numeric.sub),S=numeric.add,P=numeric.tensor,A=numeric.div,j=numeric.mul,O=numeric.all,D=numeric.isFinite,F=numeric.neg,E=0,V="";for(y=t(r);E<i;){if("function"==typeof o&&o(E,r,l,y,T)){V="Callback returned true";break}if(!O(D(y))){V="Gradient has Infinity or NaN";break}if(p=F(M(T,y)),!O(D(p))){V="Search direction has Infinity or NaN";break}if((k=h(p))<n){V="Newton step smaller than tol";break}for(w=1,c=M(y,p),v=r;E<i&&!(w*k<n)&&(d=j(p,w),v=S(r,d),(s=e(v))-l>=.1*w*c||isNaN(s));)w*=.5,++E;if(w*k<n){V="Line search step size smaller than tol";break}if(E===i){V="maxit reached during line search";break}g=t(v),_=C(g,y),x=M(_,d),b=M(T,_),T=C(S(T,j((x+M(_,b))/(x*x),P(d,d))),A(S(P(b,d),P(d,b)),x)),r=v,l=s,y=g,++E}return{solution:r,f:l,gradient:y,invHessian:T,iterations:E,message:V}},numeric.Dopri=function(e,r,n,t,i,o,u){this.x=e,this.y=r,this.f=n,this.ymid=t,this.iterations=i,this.events=u,this.message=o},numeric.Dopri.prototype._at=function(e,r){function n(e){return e*e}var t,i,o,u,a,s,e,c,f,l,m,h=this,p=h.x,y=h.y,g=h.f,d=h.ymid,v=(p.length,Math.floor,numeric.add),_=numeric.mul,b=numeric.sub;return t=p[r],i=p[r+1],u=y[r],a=y[r+1],c=i-t,o=t+.5*c,s=d[r],f=b(g[r],_(u,1/(t-o)+2/(t-i))),l=b(g[r+1],_(a,1/(i-o)+2/(i-t))),m=[n(e-i)*(e-o)/n(t-i)/(t-o),n(e-t)*n(e-i)/n(t-o)/n(i-o),n(e-t)*(e-o)/n(i-t)/(i-o),(e-t)*n(e-i)*(e-o)/n(t-i)/(t-o),(e-i)*n(e-t)*(e-o)/n(t-i)/(i-o)],v(v(v(v(_(u,m[0]),_(s,m[1])),_(a,m[2])),_(f,m[3])),_(l,m[4]))},numeric.Dopri.prototype.at=function(e){var r,n,t,i=Math.floor;if("number"!=typeof e){var o=e.length,u=Array(o);for(r=o-1;-1!==r;--r)u[r]=this.at(e[r]);return u}var a=this.x;for(r=0,n=a.length-1;n-r>1;)t=i(.5*(r+n)),a[t]<=e?r=t:n=t;return this._at(e,r)},numeric.dopri=function(e,r,n,t,i,o,u){void 0===i&&(i=1e-6),void 0===o&&(o=1e3);var a,s,c,f,l,m,h,p,y,g,d,v,_,b=[e],x=[n],w=[t(e,n)],k=[],T=[.075,.225],M=[44/45,-56/15,32/9],C=[19372/6561,-25360/2187,64448/6561,-212/729],S=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],P=[35/384,0,500/1113,125/192,-2187/6784,11/84],A=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],j=[.2,.3,.8,8/9,1,1],O=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,.025],D=0,F=(r-e)/10,E=0,V=numeric.add,L=numeric.mul,N=(Math.max,Math.min),q=Math.abs,I=numeric.norminf,G=Math.pow,B=numeric.any,R=numeric.lt,U=numeric.and,X=(numeric.sub,new numeric.Dopri(b,x,w,k,-1,""));for("function"==typeof u&&(d=u(e,n));e<r&&E<o;)if(++E,e+F>r&&(F=r-e),a=t(e+j[0]*F,V(n,L(.2*F,w[D]))),s=t(e+j[1]*F,V(V(n,L(T[0]*F,w[D])),L(T[1]*F,a))),c=t(e+j[2]*F,V(V(V(n,L(M[0]*F,w[D])),L(M[1]*F,a)),L(M[2]*F,s))),f=t(e+j[3]*F,V(V(V(V(n,L(C[0]*F,w[D])),L(C[1]*F,a)),L(C[2]*F,s)),L(C[3]*F,c))),l=t(e+j[4]*F,V(V(V(V(V(n,L(S[0]*F,w[D])),L(S[1]*F,a)),L(S[2]*F,s)),L(S[3]*F,c)),L(S[4]*F,f))),y=V(V(V(V(V(n,L(w[D],F*P[0])),L(s,F*P[2])),L(c,F*P[3])),L(f,F*P[4])),L(l,F*P[5])),m=t(e+F,y),h=V(V(V(V(V(L(w[D],F*O[0]),L(s,F*O[2])),L(c,F*O[3])),L(f,F*O[4])),L(l,F*O[5])),L(m,F*O[6])),g="number"==typeof h?q(h):I(h),g>i){if(F=.2*F*G(i/g,.25),e+F===e){X.msg="Step size became too small";break}}else{if(k[D]=V(V(V(V(V(V(n,L(w[D],F*A[0])),L(s,F*A[2])),L(c,F*A[3])),L(f,F*A[4])),L(l,F*A[5])),L(m,F*A[6])),++D,b[D]=e+F,x[D]=y,w[D]=m,"function"==typeof u){var z,Y,Q=e,H=e+.5*F;if(v=u(H,k[D-1]),_=U(R(d,0),R(0,v)),B(_)||(Q=H,H=e+F,d=v,v=u(H,y),_=U(R(d,0),R(0,v))),B(_)){for(var K,Z,J=0,W=1,$=1;;){if("number"==typeof d)Y=($*v*Q-W*d*H)/($*v-W*d);else for(Y=H,p=d.length-1;-1!==p;--p)d[p]<0&&v[p]>0&&(Y=N(Y,($*v[p]*Q-W*d[p]*H)/($*v[p]-W*d[p])));if(Y<=Q||Y>=H)break;z=X._at(Y,D-1),Z=u(Y,z),K=U(R(d,0),R(0,Z)),B(K)?(H=Y,v=Z,_=K,$=1,-1===J?W*=.5:W=1,J=-1):(Q=Y,d=Z,W=1,1===J?$*=.5:$=1,J=1)}return y=X._at(.5*(e+Y),D-1),X.f[D]=t(Y,z),X.x[D]=Y,X.y[D]=z,X.ymid[D-1]=y,X.events=_,X.iterations=E,X}}e+=F,n=y,d=v,F=N(.8*F*G(i/g,.25),4*F)}return X.iterations=E,X},numeric.LU=function(e,r){r=r||!1;var n,t,i,o,u,a,s,c,f,l=Math.abs,m=e.length,h=m-1,p=new Array(m);for(r||(e=numeric.clone(e)),i=0;i<m;++i){for(s=i,a=e[i],f=l(a[i]),t=i+1;t<m;++t)o=l(e[t][i]),f<o&&(f=o,s=t);for(p[i]=s,s!=i&&(e[i]=e[s],e[s]=a,a=e[i]),u=a[i],n=i+1;n<m;++n)e[n][i]/=u;for(n=i+1;n<m;++n){for(c=e[n],t=i+1;t<h;++t)c[t]-=c[i]*a[t],++t,c[t]-=c[i]*a[t];t===h&&(c[t]-=c[i]*a[t])}}return{LU:e,P:p}},numeric.LUsolve=function(e,r){var n,t,i,o,u,a=e.LU,s=a.length,c=numeric.clone(r),f=e.P;for(n=s-1;-1!==n;--n)c[n]=r[n];for(n=0;n<s;++n)for(i=f[n],f[n]!==n&&(u=c[n],c[n]=c[i],c[i]=u),o=a[n],t=0;t<n;++t)c[n]-=c[t]*o[t];for(n=s-1;n>=0;--n){for(o=a[n],t=n+1;t<s;++t)c[n]-=c[t]*o[t];c[n]/=o[n]}return c},numeric.solve=function(e,r,n){return numeric.LUsolve(numeric.LU(e,n),r)},numeric.echelonize=function(e){var r,n,t,i,o,u,a,s,c=numeric.dim(e),f=c[0],l=c[1],m=numeric.identity(f),h=Array(f),p=Math.abs,y=numeric.diveq;for(e=numeric.clone(e),r=0;r<f;++r){for(t=0,o=e[r],u=m[r],n=1;n<l;++n)p(o[t])<p(o[n])&&(t=n);for(h[r]=t,y(u,o[t]),y(o,o[t]),n=0;n<f;++n)if(n!==r){for(a=e[n],s=a[t],i=l-1;-1!==i;--i)a[i]-=o[i]*s;for(a=m[n],i=f-1;-1!==i;--i)a[i]-=u[i]*s}}return{I:m,A:e,P:h}},numeric.__solveLP=function(e,r,n,t,i,o,u){var a,s,c,f,l=numeric.sum,m=(numeric.log,numeric.mul),h=numeric.sub,p=numeric.dot,y=numeric.div,g=numeric.add,d=e.length,v=n.length,_=!1,b=1,x=(numeric.transpose(r),numeric.svd,numeric.transpose),w=(numeric.leq,Math.sqrt),k=Math.abs,T=(numeric.muleq,numeric.norminf,numeric.any,Math.min),M=numeric.all,C=numeric.gt,S=Array(d),P=Array(v),A=(numeric.rep([v],1),numeric.solve),j=h(n,p(r,o)),O=p(e,e);for(c=0;c<i;++c){var D,F;for(D=v-1;-1!==D;--D)P[D]=y(r[D],j[D]);var E=x(P);for(D=d-1;-1!==D;--D)S[D]=l(E[D]);b=.25*k(O/p(e,S));var V=100*w(O/p(S,S));for((!isFinite(b)||b>V)&&(b=V),f=g(e,m(b,S)),s=p(E,P),D=d-1;-1!==D;--D)s[D][D]+=1;F=A(s,y(f,b),!0);var L=y(j,p(r,F)),N=1;for(D=v-1;-1!==D;--D)L[D]<0&&(N=T(N,-.999*L[D]));if(a=h(o,m(F,N)),j=h(n,p(r,a)),!M(C(j,0)))return{solution:o,message:"",iterations:c};if(o=a,b<t)return{solution:a,message:"",iterations:c};if(u){var q=p(e,f),I=p(r,f);for(_=!0,D=v-1;-1!==D;--D)if(q*I[D]<0){_=!1;break}}else _=!(o[d-1]>=0);if(_)return{solution:a,message:"Unbounded",iterations:c}}return{solution:o,message:"maximum iteration count exceeded",iterations:c}},numeric._solveLP=function(e,r,n,t,i){var o,u=e.length,a=n.length,s=(numeric.sum,numeric.log,numeric.mul,numeric.sub),c=numeric.dot,f=(numeric.div,numeric.add,numeric.rep([u],0).concat([1])),l=numeric.rep([a,1],-1),m=numeric.blockMatrix([[r,l]]),h=n,o=numeric.rep([u],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),p=numeric.__solveLP(f,m,h,t,i,o,!1),y=numeric.clone(p.solution);if(y.length=u,numeric.inf(s(n,c(r,y)))<0)return{solution:NaN,message:"Infeasible",iterations:p.iterations};var g=numeric.__solveLP(e,r,n,t,i-p.iterations,y,!0);return g.iterations+=p.iterations,g},numeric.solveLP=function(e,r,n,t,i,o,u){if(void 0===u&&(u=1e3),void 0===o&&(o=numeric.epsilon),void 0===t)return numeric._solveLP(e,r,n,o,u);var a,s=t.length,c=t[0].length,f=r.length,l=numeric.echelonize(t),m=numeric.rep([c],0),h=l.P,p=[];for(a=h.length-1;-1!==a;--a)m[h[a]]=1;for(a=c-1;-1!==a;--a)0===m[a]&&p.push(a);var y=numeric.getRange,g=numeric.linspace(0,s-1),d=numeric.linspace(0,f-1),v=y(t,g,p),_=y(r,d,h),b=y(r,d,p),x=numeric.dot,w=numeric.sub,k=x(_,l.I),T=w(b,x(k,v)),M=w(n,x(k,i)),C=Array(h.length),S=Array(p.length);for(a=h.length-1;-1!==a;--a)C[a]=e[h[a]];for(a=p.length-1;-1!==a;--a)S[a]=e[p[a]];var P=w(S,x(C,x(l.I,v))),A=numeric._solveLP(P,T,M,o,u),j=A.solution;if(j!==j)return A;var O=x(l.I,w(i,x(v,j))),D=Array(e.length);for(a=h.length-1;-1!==a;--a)D[h[a]]=O[a];for(a=p.length-1;-1!==a;--a)D[p[a]]=j[a];return{solution:D,message:A.message,iterations:A.iterations}},numeric.MPStoLP=function(e){function r(r){throw new Error("MPStoLP: "+r+"\nLine "+n+": "+e[n]+"\nCurrent state: "+a[u]+"\n")}e instanceof String&&e.split("\n");var n,t,i,o,u=0,a=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],s=e.length,c=0,f={},l=[],m=0,h={},p=0,y=[],g=[],d=[];for(n=0;n<s;++n){i=e[n];var v=i.match(/\S*/g),_=[];for(t=0;t<v.length;++t)""!==v[t]&&_.push(v[t]);if(0!==_.length){for(t=0;t<a.length&&i.substr(0,a[t].length)!==a[t];++t);if(t<a.length){if(u=t,1===t&&(o=_[1]),6===t)return{name:o,c:y,A:numeric.transpose(g),b:d,rows:f,vars:h}}else switch(u){case 0:case 1:r("Unexpected line");case 2:switch(_[0]){case"N":0===c?c=_[1]:r("Two or more N rows");break;case"L":f[_[1]]=m,l[m]=1,d[m]=0,++m;break;case"G":f[_[1]]=m,l[m]=-1,d[m]=0,++m;break;case"E":f[_[1]]=m,l[m]=0,d[m]=0,++m;break;default:r("Parse error "+numeric.prettyPrint(_))}break;case 3:h.hasOwnProperty(_[0])||(h[_[0]]=p,y[p]=0,g[p]=numeric.rep([m],0),++p);var b=h[_[0]];for(t=1;t<_.length;t+=2)if(_[t]!==c){var x=f[_[t]];g[b][x]=(l[x]<0?-1:1)*parseFloat(_[t+1])}else y[b]=parseFloat(_[t+1]);break;case 4:for(t=1;t<_.length;t+=2)d[f[_[t]]]=(l[f[_[t]]]<0?-1:1)*parseFloat(_[t+1]);break;case 5:break;case 6:r("Internal error")}}}r("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,r,n,t,i,o,u){function a(e){var r,t,i=this,o=e.length,u=0,a=i.i=i.j=i.m=0;for(i.S=[],i.c=[],o||(e=[o++]);u<n;)i.S[u]=u++;for(u=0;u<n;u++)r=i.S[u],a=f(a+r+e[u%o]),t=i.S[a],i.S[u]=t,i.S[a]=r;i.g=function(e){
var r=i.S,t=f(i.i+1),o=r[t],u=f(i.j+o),a=r[u];r[t]=a,r[u]=o;for(var s=r[f(o+a)];--e;)t=f(t+1),o=r[t],u=f(u+o),a=r[u],r[t]=a,r[u]=o,s=s*n+r[f(o+a)];return i.i=t,i.j=u,s},i.g(n)}function s(e,r,n,t,i){if(n=[],i=void 0===e?"undefined":_typeof(e),r&&"object"==i)for(t in e)if(t.indexOf("S")<5)try{n.push(s(e[t],r-1))}catch(e){}return n.length?n:e+("string"!=i?"\0":"")}function c(e,r,n,t){for(e+="",n=0,t=0;t<e.length;t++)r[f(t)]=f((n^=19*r[f(t)])+e.charCodeAt(t));e="";for(t in r)e+=String.fromCharCode(r[t]);return e}function f(e){return e&n-1}r.seedrandom=function(t,f){var l,m=[];return t=c(s(f?[t,e]:arguments.length?t:[(new Date).getTime(),e,window],3),m),l=new a(m),c(l.S,e),r.random=function(){for(var e=l.g(6),r=u,t=0;e<i;)e=(e+t)*n,r*=n,t=l.g(1);for(;e>=o;)e/=2,r/=2,t>>>=1;return(e+t)/r},t},u=r.pow(n,6),i=r.pow(2,i),o=2*i,c(r.random(),e)}([],numeric.seedrandom,256,0,52),function(e){function r(e){if("object"!=(void 0===e?"undefined":_typeof(e)))return e;var n,t=[],i=e.length;for(n=0;n<i;n++)t[n+1]=r(e[n]);return t}function n(e){if("object"!=(void 0===e?"undefined":_typeof(e)))return e;var r,t=[],i=e.length;for(r=1;r<i;r++)t[r-1]=n(e[r]);return t}function t(e,r,n){var t,i,o,u,a;for(o=1;o<=n;o+=1){for(e[o][o]=1/e[o][o],a=-e[o][o],t=1;t<o;t+=1)e[t][o]=a*e[t][o];if(u=o+1,n<u)break;for(i=u;i<=n;i+=1)for(a=e[o][i],e[o][i]=0,t=1;t<=o;t+=1)e[t][i]=e[t][i]+a*e[t][o]}}function i(e,r,n,t){var i,o,u,a;for(o=1;o<=n;o+=1){for(a=0,i=1;i<o;i+=1)a+=e[i][o]*t[i];t[o]=(t[o]-a)/e[o][o]}for(u=1;u<=n;u+=1)for(o=n+1-u,t[o]=t[o]/e[o][o],a=-t[o],i=1;i<o;i+=1)t[i]=t[i]+a*e[i][o]}function o(e,r,n,t){var i,o,u,a,s,c;for(o=1;o<=n;o+=1){if(t[1]=o,c=0,u=o-1,u<1){if((c=e[o][o]-c)<=0)break;e[o][o]=Math.sqrt(c)}else{for(a=1;a<=u;a+=1){for(s=e[a][o],i=1;i<a;i+=1)s-=e[i][o]*e[i][a];s/=e[a][a],e[a][o]=s,c+=s*s}if((c=e[o][o]-c)<=0)break;e[o][o]=Math.sqrt(c)}t[1]=0}}function u(e,r,n,u,a,s,c,f,l,m,h,p,y,g,d,v){function _(){return d[j+y]=d[j+y+1],d[j+y+1]=0,p[y]=0,y-=1,g[2]=g[2]+1,0}var b,x,w,k,T,M,C,S,P,A,j,O,D,F,E,V,L,N,q,I,G,B,R,U,X,z,Y;D=Math.min(u,m),w=2*u+D*(D+5)/2+2*m+1,U=1e-60;do{U+=U,X=1+.1*U,z=1+.2*U}while(X<=1||z<=1);for(b=1;b<=u;b+=1)d[b]=r[b];for(b=u+1;b<=w;b+=1)d[b]=0;for(b=1;b<=m;b+=1)p[b]=0;if(T=[],0===v[1]){if(o(e,n,u,T),0!==T[1])return void(v[1]=2);i(e,n,u,r),t(e,n,u)}else{for(x=1;x<=u;x+=1)for(a[x]=0,b=1;b<=x;b+=1)a[x]=a[x]+e[b][x]*r[b];for(x=1;x<=u;x+=1)for(r[x]=0,b=x;b<=u;b+=1)r[x]=r[x]+e[x][b]*a[b]}for(s[1]=0,x=1;x<=u;x+=1)for(a[x]=r[x],s[1]=s[1]+d[x]*a[x],d[x]=0,b=x+1;b<=u;b+=1)e[b][x]=0;for(s[1]=-s[1]/2,v[1]=0,C=u,S=C+u,j=S+D,P=j+D+1,A=P+D*(D+1)/2,F=A+m,b=1;b<=m;b+=1){for(V=0,x=1;x<=u;x+=1)V+=c[x][b]*c[x][b];d[F+b]=Math.sqrt(V)}for(y=0,g[1]=0,g[2]=0,Y=0;;){if(999===(Y=function(){for(g[1]=g[1]+1,w=A,b=1;b<=m;b+=1){for(w+=1,V=-f[b],x=1;x<=u;x+=1)V+=c[x][b]*a[x];if(Math.abs(V)<U&&(V=0),b>h)d[w]=V;else if(d[w]=-Math.abs(V),V>0){for(x=1;x<=u;x+=1)c[x][b]=-c[x][b];f[b]=-f[b]}}for(b=1;b<=y;b+=1)d[A+p[b]]=0;for(O=0,E=0,b=1;b<=m;b+=1)d[A+b]<E*d[F+b]&&(O=b,E=d[A+b]/d[F+b]);return 0===O?999:0}()))return;for(;0!==(Y=function(){for(b=1;b<=u;b+=1){for(V=0,x=1;x<=u;x+=1)V+=e[x][b]*c[x][O];d[b]=V}for(k=C,b=1;b<=u;b+=1)d[k+b]=0;for(x=y+1;x<=u;x+=1)for(b=1;b<=u;b+=1)d[k+b]=d[k+b]+e[b][x]*d[x];for(B=!0,b=y;b>=1;b-=1){for(V=d[b],w=P+b*(b+3)/2,k=w-b,x=b+1;x<=y;x+=1)V-=d[w]*d[S+x],w+=x;if(V/=d[k],d[S+b]=V,p[b]<h)break;if(V<0)break;B=!1,M=b}if(!B)for(L=d[j+M]/d[S+M],b=1;b<=y&&!(p[b]<h)&&!(d[S+b]<0);b+=1)(E=d[j+b]/d[S+b])<L&&(L=E,M=b);for(V=0,b=C+1;b<=C+u;b+=1)V+=d[b]*d[b];if(Math.abs(V)<=U){if(B)return v[1]=1,999;for(b=1;b<=y;b+=1)d[j+b]=d[j+b]-L*d[S+b];return d[j+y+1]=d[j+y+1]+L,700}for(V=0,b=1;b<=u;b+=1)V+=d[C+b]*c[b][O];for(N=-d[A+O]/V,R=!0,B||L<N&&(N=L,R=!1),b=1;b<=u;b+=1)a[b]=a[b]+N*d[C+b],Math.abs(a[b])<U&&(a[b]=0);for(s[1]=s[1]+N*V*(N/2+d[j+y+1]),b=1;b<=y;b+=1)d[j+b]=d[j+b]-N*d[S+b];if(d[j+y+1]=d[j+y+1]+N,!R){for(V=-f[O],x=1;x<=u;x+=1)V+=a[x]*c[x][O];if(O>h)d[A+O]=V;else if(d[A+O]=-Math.abs(V),V>0){for(x=1;x<=u;x+=1)c[x][O]=-c[x][O];f[O]=-f[O]}return 700}for(y+=1,p[y]=O,w=P+(y-1)*y/2+1,b=1;b<=y-1;b+=1)d[w]=d[b],w+=1;if(y===u)d[w]=d[u];else{for(b=u;b>=y+1&&0!==d[b]&&(q=Math.max(Math.abs(d[b-1]),Math.abs(d[b])),I=Math.min(Math.abs(d[b-1]),Math.abs(d[b])),E=d[b-1]>=0?Math.abs(q*Math.sqrt(1+I*I/(q*q))):-Math.abs(q*Math.sqrt(1+I*I/(q*q))),q=d[b-1]/E,I=d[b]/E,1!==q);b-=1)if(0===q)for(d[b-1]=I*E,x=1;x<=u;x+=1)E=e[x][b-1],e[x][b-1]=e[x][b],e[x][b]=E;else for(d[b-1]=E,G=I/(1+q),x=1;x<=u;x+=1)E=q*e[x][b-1]+I*e[x][b],e[x][b]=G*(e[x][b-1]+E)-e[x][b],e[x][b-1]=E;d[w]=d[y]}return 0}());){if(999===Y)return;if(700===Y)if(M===y)_();else{for(;function(){if(w=P+M*(M+1)/2+1,k=w+M,0===d[k])return 798;if(q=Math.max(Math.abs(d[k-1]),Math.abs(d[k])),I=Math.min(Math.abs(d[k-1]),Math.abs(d[k])),E=d[k-1]>=0?Math.abs(q*Math.sqrt(1+I*I/(q*q))):-Math.abs(q*Math.sqrt(1+I*I/(q*q))),q=d[k-1]/E,I=d[k]/E,1===q)return 798;if(0===q){for(b=M+1;b<=y;b+=1)E=d[k-1],d[k-1]=d[k],d[k]=E,k+=b;for(b=1;b<=u;b+=1)E=e[b][M],e[b][M]=e[b][M+1],e[b][M+1]=E}else{for(G=I/(1+q),b=M+1;b<=y;b+=1)E=q*d[k-1]+I*d[k],d[k]=G*(d[k-1]+E)-d[k],d[k-1]=E,k+=b;for(b=1;b<=u;b+=1)E=q*e[b][M]+I*e[b][M+1],e[b][M+1]=G*(e[b][M]+E)-e[b][M+1],e[b][M]=E}return 0}(),797===(Y=function(){for(k=w-M,b=1;b<=M;b+=1)d[k]=d[w],w+=1,k+=1;return d[j+M]=d[j+M+1],p[M]=p[M+1],M+=1,M<y?797:0}()););_()}}}}function a(e,t,i,o,a,s){e=r(e),t=r(t),i=r(i);var c,f,l,m,h,p,y=[],g=[],d=[],v=[],_=[];if(a=a||0,s=s?r(s):[void 0,0],o=o?r(o):[],f=e.length-1,l=i[1].length-1,!o)for(c=1;c<=l;c+=1)o[c]=0;for(c=1;c<=l;c+=1)g[c]=0;for(m=0,h=Math.min(f,l),c=1;c<=f;c+=1)d[c]=0;for(y[1]=0,c=1;c<=2*f+h*(h+5)/2+2*l+1;c+=1)v[c]=0;for(c=1;c<=2;c+=1)_[c]=0;return u(e,t,f,f,d,y,i,o,f,l,a,g,m,_,v,s),p="",1===s[1]&&(p="constraints are inconsistent, no solution!"),2===s[1]&&(p="matrix D in quadratic function is not positive definite!"),{solution:n(d),value:n(y),unconstrained_solution:n(t),iterations:n(_),iact:n(g),message:p}}e.solveQP=a}(numeric),numeric.svd=function(e){function r(e,r){return e=Math.abs(e),r=Math.abs(r),e>r?e*Math.sqrt(1+r*r/e/e):0==r?e:r*Math.sqrt(1+e*e/r/r)}var n,t=numeric.epsilon,i=1e-64/t,o=0,u=0,a=0,s=0,c=0,f=numeric.clone(e),l=f.length,m=f[0].length;if(l<m)throw"Need more rows than columns";var h=new Array(m),p=new Array(m);for(u=0;u<m;u++)h[u]=p[u]=0;var y=numeric.rep([m,m],0),g=0,d=0,v=0,_=0,b=0,x=0,w=0;for(u=0;u<m;u++){for(h[u]=d,w=0,c=u+1,a=u;a<l;a++)w+=f[a][u]*f[a][u];if(w<=i)d=0;else for(g=f[u][u],d=Math.sqrt(w),g>=0&&(d=-d),v=g*d-w,f[u][u]=g-d,a=c;a<m;a++){for(w=0,s=u;s<l;s++)w+=f[s][u]*f[s][a];for(g=w/v,s=u;s<l;s++)f[s][a]+=g*f[s][u]}for(p[u]=d,w=0,a=c;a<m;a++)w+=f[u][a]*f[u][a];if(w<=i)d=0;else{for(g=f[u][u+1],d=Math.sqrt(w),g>=0&&(d=-d),v=g*d-w,f[u][u+1]=g-d,a=c;a<m;a++)h[a]=f[u][a]/v;for(a=c;a<l;a++){for(w=0,s=c;s<m;s++)w+=f[a][s]*f[u][s];for(s=c;s<m;s++)f[a][s]+=w*h[s]}}(b=Math.abs(p[u])+Math.abs(h[u]))>_&&(_=b)}for(u=m-1;-1!=u;u+=-1){if(0!=d){for(v=d*f[u][u+1],a=c;a<m;a++)y[a][u]=f[u][a]/v;for(a=c;a<m;a++){for(w=0,s=c;s<m;s++)w+=f[u][s]*y[s][a];for(s=c;s<m;s++)y[s][a]+=w*y[s][u]}}for(a=c;a<m;a++)y[u][a]=0,y[a][u]=0;y[u][u]=1,d=h[u],c=u}for(u=m-1;-1!=u;u+=-1){for(c=u+1,d=p[u],a=c;a<m;a++)f[u][a]=0;if(0!=d){for(v=f[u][u]*d,a=c;a<m;a++){for(w=0,s=c;s<l;s++)w+=f[s][u]*f[s][a];for(g=w/v,s=u;s<l;s++)f[s][a]+=g*f[s][u]}for(a=u;a<l;a++)f[a][u]=f[a][u]/d}else for(a=u;a<l;a++)f[a][u]=0;f[u][u]+=1}for(t*=_,s=m-1;-1!=s;s+=-1)for(var k=0;k<50;k++){var T=!1;for(c=s;-1!=c;c+=-1){if(Math.abs(h[c])<=t){T=!0;break}if(Math.abs(p[c-1])<=t)break}if(!T){o=0,w=1;var M=c-1;for(u=c;u<s+1&&(g=w*h[u],h[u]=o*h[u],!(Math.abs(g)<=t));u++)for(d=p[u],v=r(g,d),p[u]=v,o=d/v,w=-g/v,a=0;a<l;a++)b=f[a][M],x=f[a][u],f[a][M]=b*o+x*w,f[a][u]=-b*w+x*o}if(x=p[s],c==s){if(x<0)for(p[s]=-x,a=0;a<m;a++)y[a][s]=-y[a][s];break}if(k>=49)throw"Error: no convergence.";for(_=p[c],b=p[s-1],d=h[s-1],v=h[s],g=((b-x)*(b+x)+(d-v)*(d+v))/(2*v*b),d=r(g,1),g=g<0?((_-x)*(_+x)+v*(b/(g-d)-v))/_:((_-x)*(_+x)+v*(b/(g+d)-v))/_,o=1,w=1,u=c+1;u<s+1;u++){for(d=h[u],b=p[u],v=w*d,d*=o,x=r(g,v),h[u-1]=x,o=g/x,w=v/x,g=_*o+d*w,d=-_*w+d*o,v=b*w,b*=o,a=0;a<m;a++)_=y[a][u-1],x=y[a][u],y[a][u-1]=_*o+x*w,y[a][u]=-_*w+x*o;for(x=r(g,v),p[u-1]=x,o=g/x,w=v/x,g=o*d+w*b,_=-w*d+o*b,a=0;a<l;a++)b=f[a][u-1],x=f[a][u],f[a][u-1]=b*o+x*w,f[a][u]=-b*w+x*o}h[c]=0,h[s]=g,p[s]=_}for(u=0;u<p.length;u++)p[u]<t&&(p[u]=0);for(u=0;u<m;u++)for(a=u-1;a>=0;a--)if(p[a]<p[u]){for(o=p[a],p[a]=p[u],p[u]=o,s=0;s<f.length;s++)n=f[s][u],f[s][u]=f[s][a],f[s][a]=n;for(s=0;s<y.length;s++)n=y[s][u],y[s][u]=y[s][a],y[s][a]=n;u=a}return{U:f,S:p,V:y}};var _slicedToArray=function(){function e(e,r){var n=[],t=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(t=(u=a.next()).done)&&(n.push(u.value),!r||n.length!==r);t=!0);}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),NotEnoughPointsException=function e(){_classCallCheck(this,e)},FitterUtilities=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getXTXMatrix",value:function(e){var r=e*e,n=r*e;return[[e,e/2+.5,e/3+.5+1/(6*e),(r+2*e+1)/(4*e)],[e/2+.5,e/3+.5+1/(6*e),(r+2*e+1)/(4*e),e/5+.5+1/(3*e)-1/(30*n)],[e/3+.5+1/(6*e),(r+2*e+1)/(4*e),e/5+.5+1/(3*e)-1/(30*n),e/6+.5+5/(12*e)-1/(12*n)],[(r+2*e+1)/(4*e),e/5+.5+1/(3*e)-1/(30*n),e/6+.5+5/(12*e)-1/(12*n),e/7+.5+1/(2*e)-1/(6*n)+1/(n*e*e*42)]]}},{key:"calculateSumOfPolynomialAtParameters",value:function(e,r){var n=e[0],t=e[1],i=e[2],o=e[3],u=r*r,a=u*r;return n*t+n*i+n*o+t*t/2+t*i+t*o+i*i/2+i*o+o*o/2+o*o/(a*r*r*42)+r*(n*n+n*t+2*n*i/3+n*o/2+t*t/3+t*i/2+2*t*o/5+i*i/5+i*o/3+o*o/7)+(n*i/3+n*o/2+t*t/6+t*i/2+2*t*o/3+i*i/3+5*i*o/6+o*o/2)/r+(-t*o/15-i*i/30-i*o/6-o*o/6)/a}},{key:"mathematicModulo",value:function(e,r){var n=e%r;return n<0?n+r:n}},{key:"matchedPolynomialToBezierHandles",value:function(e){var r=_slicedToArray(e,4),n=r[0],t=r[1],i=r[2],o=r[3],u=n,a=n+t+i+o;return[u,t/3+u,a-(t+2*i+3*o)/3,a]}},{key:"matchedPlanePolynomialsToBezierHandles",value:function(r){var n=_slicedToArray(r,2),t=n[0],i=n[1],o=e.matchedPolynomialToBezierHandles(t),u=_slicedToArray(o,4),a=u[0],s=u[1],c=u[2],f=u[3],l=e.matchedPolynomialToBezierHandles(i),m=_slicedToArray(l,4);return[[a,m[0]],[s,m[1]],[c,m[2]],[f,m[3]]]}}]),e}(),SingleDimensionFitter=function(){function e(){_classCallCheck(this,e),this._sum_vt=[0,0,0,0],this.reset()}return _createClass(e,[{key:"reset",value:function(){this._nopoints=0,this._squareSum=0;for(var e=this._sum_vt.length,r=0;r<e;++r)this._sum_vt[r]=0}},{key:"insertPoint",value:function(e){for(var r=this._nopoints+1,n=this._sum_vt.length,t=0;t<n;++t)this._sum_vt[t]+=e,e*=r;this._squareSum+=e*e,this._nopoints=r}},{key:"fitCurve",value:function(e){if(this._nopoints<4)throw new NotEnoughPointsException;for(var r=this._sum_vt.length,n=new Array(r),t=1,i=0;i<r;++i)n[i]=this._sum_vt[i]/t,t*=this._nopoints;var o=numeric.solve(e,n),u=numeric.dotVV(o,n);return[o,FitterUtilities.calculateSumOfPolynomialAtParameters(o,this._nopoints)+this._squareSum-2*u]}},{key:"numberOfPoints",get:function(){return this._nopoints}}]),e}(),PlaneFitter=function(){function e(){_classCallCheck(this,e),this._fitter1=new SingleDimensionFitter,this._fitter2=new SingleDimensionFitter}return _createClass(e,[{key:"reset",value:function(){this._fitter1.reset(),this._fitter2.reset()}},{key:"insertPoint",value:function(e){var r=_slicedToArray(e,2),n=r[0],t=r[1];this._fitter1.insertPoint(n),this._fitter2.insertPoint(t)}},{key:"fitCurve",value:function(e){var r=e||FitterUtilities.getXTXMatrix(this._fitter1.numberOfPoints),n=this._fitter1.fitCurve(r),t=_slicedToArray(n,2),i=t[0],o=t[1],u=this._fitter2.fitCurve(r),a=_slicedToArray(u,2);return[[i,a[0]],o+a[1]]}},{key:"numberOfPoints",get:function(){return this._fitter1.numberOfPoints}}]),e}(),VariableLengthFitterBase=function(){function e(r){var n=r.frameSize,t=r.gestureSpan;_classCallCheck(this,e),this._frameSize=n,this._gestureSpan=t,this._noOfPointsInCurrentFrame=0,this._lastResetInCycle=0,this._fitters=new Array(t);for(var i=0;i<t;i++)this._fitters[i]=new PlaneFitter}return _createClass(e,[{key:"reset",value:function(){for(var e=0;e<this._gestureSpan;e++)this._fitters[e].reset();this._lastResetInCycle=0}},{key:"insertPoint",value:function(e){this._insertPointToAllFitters(e),++this._noOfPointsInCurrentFrame>=this._frameSize&&(this._noOfPointsInCurrentFrame=0,this._resetNextInCycle(),this.hookNextFrame(),this._tryToFitCurve())}},{key:"_insertPointToAllFitters",value:function(e){for(var r=this._gestureSpan,n=0;n<r;n++)this._fitters[n].insertPoint(e)}},{key:"_resetNextInCycle",value:function(){this._lastResetInCycle=(this._lastResetInCycle+1)%this._gestureSpan,this._fitters[this._lastResetInCycle].reset()}},{key:"_tryToFitCurve",value:function(){for(var e=this._gestureSpan,r=1;r<=e;r++){var n,t,i=this._fitters[FitterUtilities.mathematicModulo(this._lastResetInCycle+r,e)],o=FitterUtilities.getXTXMatrix(i.numberOfPoints);try{var u=i.fitCurve(o),a=_slicedToArray(u,2);n=a[0],t=a[1]}catch(e){if(e instanceof NotEnoughPointsException)continue;throw e}if(this.processCurve(n,t,i.numberOfPoints))return void this.reset()}}},{key:"processCurve",value:function(e,r,n){throw new TypeError("Do not call abstract method processCurve.")}},{key:"hookNextFrame",value:function(){}}]),e}(),_slicedToArray=function(){function e(e,r){var n=[],t=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(t=(u=a.next()).done)&&(n.push(u.value),!r||n.length!==r);t=!0);}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),FeatureExtractor=function(){function e(r){var n=r.frameSize;_classCallCheck(this,e),this._frameSize=n}return _createClass(e,[{key:"extractFeatures",value:function(e,r,n){return this._match_path=new paper.Path,GestureCanvas.appendMatchedPolynomialsToPath(e,this._match_path),this._curve=this._match_path.firstCurve,this._match_type=this._curve.classify().type,this._match_averageResidual=r/n,this._match_frameNumber=Math.floor(n/this._frameSize)-1,this._match_length=this._curve.length,this._calculateDirections(),this._calculateProportionInsideLoop(),this.recentFeatures={type:this._match_type,averageResidual:this._match_averageResidual,frameNumber:this._match_frameNumber,length:this._curve.length,angleIn:this._match_inDirPoint.angle,angleOut:this._match_outDirPoint.angle,tangentIn:this._match_inDirPoint,tangentOut:this._match_outDirPoint,proportionInsideLoop:this._match_proportionInsideLoop},this.recentFeatures}},{key:"_calculateDirections",value:function(){var e=.2,r=.8;if(this._match_intersectionTime1=-1,this._match_intersectionTime2=-1,"loop"==this._match_type){var n=this._curve.getIntersections(),t=_slicedToArray(n,1),i=t[0];e=i.time,r=i.intersection.time,this._match_intersectionTime1=e,this._match_intersectionTime2=r}this._match_inDirPoint=this._calculateDirection(e),this._match_outDirPoint=this._calculateDirection(r)}},{key:"_calculateProportionInsideLoop",value:function(){if(this._match_intersectionTime1<0)this._match_proportionInsideLoop=1;else{var e=this._curve.getPart(this._match_intersectionTime1,this._match_intersectionTime2),r=e.length;this._match_proportionInsideLoop=r/this._match_length}}},{key:"_calculateDirection",value:function(e){return this._curve.getTangentAtTime(e)}}],[{key:"extractAsRow",value:function(e,r,n){for(var t=[],i=0;i<r.length;i++){var o=r[i];t[i]=e[o]}return null!=n&&(t[r.length]=n),t}}]),e}(),GestureMatcher=function(){function e(r){_classCallCheck(this,e),this.gestures=r.gestureDefinitions,this.featureExtractor=new FeatureExtractor(r),this.logger=new ConsoleLogger}return _createClass(e,[{key:"tryToMatch",value:function(e,r,n){this._features=this.featureExtractor.extractFeatures(e,r,n);for(var t=0;t<this.gestures.length;t++){var i=this.gestures[t],o=!i.type||i.type==this._features.type,u=!i.inDir||this._directionSatisfied(this._features.tangentIn,i.inDir),a=!i.outDir||this._directionSatisfied(this._features.tangentOut,i.outDir),s=!i.averageResidual||this._features.averageResidual<i.averageResidual,c=!i.numberOfFrames||i.numberOfFrames[0]<=this._features.frameNumber&&this._features.frameNumber<=i.numberOfFrames[1],f=(!i.length||i.length[0]<=this._features.length&&(this._features.length,i.length[1]),o&&u&&a&&s&&c);if(f){f=this.performAdditionalCheck(e,r,n,t)}if(f)return this._recentMatchedGestureFeatures=this._features,this._recentMatchedGestureIndex=t,t}return null}},{key:"performAdditionalCheck",value:function(e,r,n,t){return!0}},{key:"debugDescriptionOfMatchedCurve",value:function(){return"FR="+this._features.frameNumber+", LN="+this._features.length}},{key:"tryMarkGesture",value:function(e){return!!this._recentMatchedGestureFeatures&&(main.globalGestureDecisionTree.addTrial(this._recentMatchedGestureFeatures,this._recentMatchedGestureIndex,e),!0)}},{key:"_performMatch",value:function(){}},{key:"_directionSatisfied",value:function(e,r){var n=r.angle,t=r.margin,i=void 0===t?60:t;return new paper.Point(1,0).rotate(n).getAngle(e)<i}}]),e}(),GestureMatcherWithTree=function(e){function r(e){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e))}return _inherits(r,e),_createClass(r,[{key:"performAdditionalCheck",value:function(e,r,n,t){var i=main.globalGestureDecisionTree.verifyGesture(this._features,t);return i?this.logger.log("Decision tree ACCEPTED gesture "+(t+1)+"."):this.logger.log("Decision tree REJECTED gesture "+(t+1)+"."),i}}]),r}(GestureMatcher),gestureSchema={definitions:{},id:"http://example.com/example.json",items:{additionalProperties:!1,id:"/items",properties:{averageResidual:{id:"/items/properties/averageResidual",type:"integer"},inDir:{additionalProperties:!1,id:"/items/properties/inDir",properties:{angle:{id:"/items/properties/inDir/properties/angle",type:"integer"},margin:{id:"/items/properties/inDir/properties/margin",type:"number"}},required:["angle"],type:"object"},numberOfFrames:{additionalItems:!1,id:"/items/properties/numberOfFrames",items:{id:"/items/properties/numberOfFrames/items",type:"integer"},maxItems:2,minItems:2,type:"array"},length:{additionalItems:!1,id:"/items/properties/length",items:{id:"/items/properties/length/items",type:"integer"},maxItems:2,minItems:2,type:"array"},outDir:{additionalProperties:!1,id:"/items/properties/outDir",properties:{angle:{id:"/items/properties/outDir/properties/angle",type:"integer"},margin:{id:"/items/properties/outDir/properties/margin",type:"integer"}},required:["angle"],type:"object"},type:{id:"/items/properties/type",type:"string",enum:["loop","arch","cusp","serpentine"]}},type:"object"},type:"array"},_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),GestureDecisionTree=function(){function e(){_classCallCheck(this,e),this.logger=new ConsoleLogger,this._featuresUnderConsideration=["type","averageResidual","frameNumber","length","angleIn","angleOut","proportionInsideLoop"],this._featuresInGestureDefinition=["type","averageResidual","numberOfFrames","length","inDir","outDir","proportionInsideLoop"],this._featureTypes=["category","number","number","number","number","number","number"],this._lastGestureBase=null}return _createClass(e,[{key:"addTrial",value:function(e,r,n){var t=this._gestureTrees[r],i=t.features,o=t.samples,u=FeatureExtractor.extractAsRow(e,i,n);o.push(u),this.logger.log("Added new sample to gesture "+(r+1)+" with match="+n+".")}},{key:"verifyGesture",value:function(e,r){var n=this._gestureTrees[r],t=(n.features,n.model);if(null==t){var i="Used GestureDecisionTree without prior retrainModels.";throw main.error(i),i}var o=e,u=t.classify(o);return"none data"==u?(this.logger.log("Accepted untrained gesture."),!0):1==u}},{key:"retrainModels",value:function(){for(var e=this,r=C45(),n=0;n<this._gestureTrees.length;n++)!function(){var t=e._gestureTrees[n];r.train({data:t.samples,target:"matchesClass",features:t.features,featureTypes:t.featureTypes},function(e,r){if(e)throw main.error(e),e;t.model=r})}();this.logger.log("Retrained decision trees.");for(var n=0;n<this._gestureTrees.length;n++){var t=this._gestureTrees[n].model.model;this.logger.log("Gesture "+(n+1)+" tree:"),main.echo(JSON.stringify(t,void 0,2))}}},{key:"verifyGestureBase",value:function(e){JSON.stringify(this._lastGestureBase)!==JSON.stringify(e)&&(this.logger.log("Updating gesture base in gesture decision tree."),this._lastGestureBase=e,this._configureGestures(e))}},{key:"resetSamples",value:function(){this._configureGestures(this._lastGestureBase)}},{key:"_configureGestures",value:function(e){this._gestureTrees=[];for(var r=0;r<e.length;r++){for(var n=e[r],t=[],i=[],o=0;o<this._featuresUnderConsideration.length;o++){var u=this._featuresInGestureDefinition[o],a=this._featuresUnderConsideration[o],s=this._featureTypes[o];n[u]||(t.push(a),i.push(s))}this._gestureTrees[r]={features:t,featureTypes:i,samples:[],model:null}}}},{key:"exportSamples",value:function(){for(var e=[],r=0;r<this._gestureTrees.length;r++){var n=this._gestureTrees[r].samples;e[r]=n}return e}},{key:"importSamples",value:function(e){for(var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=0;n<this._gestureTrees.length;n++){var t=this._gestureTrees[n].samples;r&&(t.length=0),e[n].forEach(function(e){t.push(e)})}}}]),e}(),_slicedToArray=function(){function e(e,r){var n=[],t=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(t=(u=a.next()).done)&&(n.push(u.value),!r||n.length!==r);t=!0);}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),ConsoleLogger=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"log",value:function(e){main.log(e)}}]),e}(),GestureCanvas=function(){function e(){var r=this;_classCallCheck(this,e),this.fitStrategy=new NullFitStrategy,this._mousePosition={x:0,y:0},this.paused=!1;var n=new paper.Tool;n.onMouseMove=function(e){return r._updateMouseCoords(e.point)},n.onMouseDown=function(e){return r.fitStrategy.onMouseDown({point:r._mousePosition})},n.onMouseUp=function(e){return r.fitStrategy.onMouseUp({point:r._mousePosition})},this.traceLength=300,this._traceOnPaper=new paper.Path,this._traceOnPaper.strokeColor="blue",window.setInterval(function(){return r._onUpdate()},10)}return _createClass(e,[{key:"_updateMouseCoords",value:function(e){this._mousePosition=e}},{key:"_onUpdate",value:function(){this.paused||(this._traceOnPaper.add(this._mousePosition),this._traceOnPaper.segments.length>this.traceLength&&this._traceOnPaper.removeSegment(0),this.fitStrategy.onFrame({point:this._mousePosition}))}}],[{key:"appendMatchedPolynomialsToPath",value:function(e,r){var n=FitterUtilities.matchedPlanePolynomialsToBezierHandles(e).map(function(e){var r=_slicedToArray(e,2),n=r[0],t=r[1];return new paper.Point(n,t)});r.add(n[0]),r.cubicCurveTo(n[1],n[2],n[3])}}]),e}(),NullFitStrategy=function(){function e(){_classCallCheck(this,e),this.name="Turn off"}return _createClass(e,[{key:"init",value:function(){}},{key:"clear",value:function(){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onFrame",value:function(e){var r=e.point;r.x,r.y}},{key:"onKeyDown",value:function(e){}},{key:"richDraw",set:function(e){}},{key:"logger",set:function(e){}}]),e}(),_slicedToArray=function(){function e(e,r){var n=[],t=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(t=(u=a.next()).done)&&(n.push(u.value),!r||n.length!==r);t=!0);}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),SignaledFitStrategy=function(){function e(r){_classCallCheck(this,e),this.name="Signaled",this._fitter=new PlaneFitter,this.richDraw=!0,this.logger=new ConsoleLogger,this._path=null,this._matcher=new GestureMatcher(r)}return _createClass(e,[{key:"init",value:function(){}},{key:"clear",value:function(){this._path&&this._path.remove()}},{key:"onMouseDown",value:function(e){this._fitter.reset()}},{key:"onMouseUp",value:function(e){var r=this._fitter.fitCurve(),n=_slicedToArray(r,2);this.matchedPolynomials=n[0],this.residual=n[1],this.clear();var t=new paper.Path;this._path=t,GestureCanvas.appendMatchedPolynomialsToPath(this.matchedPolynomials,t),t.strokeColor="red";var i=t.firstCurve;this.logger.log("Matched polynomial with avg residual "+Math.sqrt(this.residual)/this._fitter.numberOfPoints+" classified as "+i.classify().type+".");var o=this._matcher.tryToMatch(this.matchedPolynomials,this.residual,this._fitter.numberOfPoints);null!=o?this.logger.log("Matched gesture "+(o+1)+". ("+this._matcher.debugDescriptionOfMatchedCurve()+")"):this.logger.log("No gesture detected.")}},{key:"onFrame",value:function(e){var r=e.point,n=r.x,t=r.y;this._fitter.insertPoint([n,t])}},{key:"onKeyDown",value:function(e){switch(e.code){case"KeyQ":this._matcher.tryMarkGesture(!1);break;case"KeyW":this._matcher.tryMarkGesture(!0)}}}]),e}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),_get=function e(r,n,t){null===r&&(r=Function.prototype);var i=Object.getOwnPropertyDescriptor(r,n);if(void 0===i){var o=Object.getPrototypeOf(r);return null===o?void 0:e(o,n,t)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(t)},VariableLengthFitStrategy_colors=["#FF4511","#1DABD6","#FFBF49","#13DB7E","#72705B"],VariableLengthFitStrategy=function(e){function r(e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return n.name="Variable length",n.logger=new ConsoleLogger,n._paths=new Array,n}return _inherits(r,e),_createClass(r,[{key:"init",value:function(){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"reset",this).call(this)}},{key:"clear",value:function(){this._removePaths()}},{key:"onKeyDown",value:function(e){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"hookNextFrame",value:function(){this._removePaths()}},{key:"_removePaths",value:function(){for(var e=0;e<this._paths.length;e++)this._paths[e].remove();this._paths.length=0}},{key:"onFrame",value:function(e){var r=e.point,n=r.x,t=r.y;this.insertPoint([n,t])}},{key:"processCurve",value:function(e,r,n){var t=new paper.Path;return GestureCanvas.appendMatchedPolynomialsToPath(e,t),t.strokeColor=VariableLengthFitStrategy_colors[(Math.floor(n/this._frameSize)-1)%VariableLengthFitStrategy_colors.length],this._paths.push(t),!1}}]),r}(VariableLengthFitterBase),SimpleVariableLengthFitStrategy=function(e){function r(e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return n._matcher=new GestureMatcher(e),n._matched_path=null,n}return _inherits(r,e),_createClass(r,[{key:"processCurve",value:function(e,n,t){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"processCurve",this).call(this,e,n,t);var i=this._matcher.tryToMatch(e,n,t);return null!=i&&(this.logger.log("Matched gesture "+(i+1)+". ("+this._matcher.debugDescriptionOfMatchedCurve()+")"),this._addPath(e),!0)}},{key:"clear",value:function(){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"clear",this).call(this),this._matched_path&&this._matched_path.remove()}},{key:"onKeyDown",value:function(e){switch(e.code){case"KeyQ":this._matcher.tryMarkGesture(!1);break;case"KeyW":this._matcher.tryMarkGesture(!0)}}},{key:"_addPath",value:function(e){this._matched_path&&this._matched_path.remove(),this._matched_path=new paper.Path,GestureCanvas.appendMatchedPolynomialsToPath(e,this._matched_path),this._matched_path.strokeColor="slateblue",this._matched_path.dashArray=[10,4],this._matched_path.strokeWidth=15}}]),r}(VariableLengthFitStrategy),SimpleDecisionTreeGestureMatcher=function(e){function r(e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return n._matcher=new GestureMatcherWithTree(e),n.name="Variable length (based on decision tree)",main.globalGestureDecisionTree.verifyGestureBase(e.gestureDefinitions),main.globalGestureDecisionTree.retrainModels(),n}return _inherits(r,e),r}(SimpleVariableLengthFitStrategy),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,r){var n=[],t=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(t=(u=a.next()).done)&&(n.push(u.value),!r||n.length!==r);t=!0);}catch(e){i=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),StrategyChooser=function(){function e(r){var n=this,t=r.selectElement,i=r.strategies,o=r.gestureCanvas,u=r.applyButton,a=r.settingsToCollect;for(_classCallCheck(this,e),this._selectElement=t,this._strategies=i,this._gestureCanvas=o,this._settingsToCollect=a;t.hasChildNodes();)t.removeChild(t.lastChild);this._settings={hiddenOptions:{}},this._collectSettings();for(var s=0;s<i.length;s++){var c=i[s](this._settings),f=document.createElement("option");f.textContent=c.name,t.appendChild(f)}t.addEventListener("change",function(){return n._changed()}),u.addEventListener("click",function(){return n._changed()})}return _createClass(e,[{key:"onKeyDown",value:function(e){this._gestureCanvas.fitStrategy.onKeyDown(e)}},{key:"_changed",value:function(){var e=null;this._gestureCanvas.fitStrategy.clear();try{this._collectSettings(),e=this._strategies[this._selectElement.selectedIndex](this._settings),this._gestureCanvas.fitStrategy=e,e.init()}catch(e){main.error("Unable to initialize fitter: "+e)}e&&main.log('Changed to "'+e.name+'"'),
main.globalGestureDecisionTree.verifyGestureBase(this._settings.gestureDefinitions)}},{key:"_collectSettings",value:function(){var e=this,r=this._settings.hiddenOptions;this._settings={hiddenOptions:r},this._settingsToCollect.forEach(function(r){var n=_slicedToArray(r,2),t=n[0],i=n[1];switch(void 0===t?"undefined":_typeof(t)){case"string":var o=document.getElementById(t);e._settings[i]=o.value;break;default:e._settings[i]=t()}})}}]),e}(),_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),GestureDefinitionEditor_examples=[[{type:"loop",inDir:{angle:0,margin:60},outDir:{angle:90,margin:60}},{type:"loop",inDir:{angle:0,margin:60},outDir:{angle:-90,margin:60}},{type:"arch",inDir:{angle:180,margin:45},outDir:{angle:90,margin:45},numberOfFrames:[4,20]}]],GestureDefinitionEditor=function(){function e(r){_classCallCheck(this,e),this._editorNode=r;var n={mode:"code",schema:gestureSchema,templates:[{text:"Gesture",title:"Insert a gesture",value:{type:"loop",inDir:{angle:0,margin:60},outDir:{angle:90,margin:60}}}]};this._editor=new JSONEditor(r,n)}return _createClass(e,[{key:"setExample",value:function(e){return this._editor.set(GestureDefinitionEditor_examples[e]),!0}},{key:"get",value:function(){return this._editor.get()}}]),e}(),Main=function(){function e(){_classCallCheck(this,e),this._logCounter=0}return _createClass(e,[{key:"initialize",value:function(){var e=this;this._console=document.getElementById("console"),main.globalGestureDecisionTree=new GestureDecisionTree,paper.install(window);var r=document.getElementById("mainCanvas");paper.setup(r),this._setupEditor();var n=new GestureCanvas;this.strategyChooser=new StrategyChooser({selectElement:document.getElementById("strategyChooser"),applyButton:document.getElementById("applyButton"),gestureCanvas:n,strategies:[function(e){return new NullFitStrategy(e)},function(e){return new SignaledFitStrategy(e)},function(e){return new SimpleVariableLengthFitStrategy(e)},function(e){return new SimpleDecisionTreeGestureMatcher(e)}],settingsToCollect:[["frameSize","frameSize"],["gestureSpan","gestureSpan"],[function(){return e.editor.get()},"gestureDefinitions"]]}),document.addEventListener("keydown",function(r){if(r.altKey)switch(r.code){case"KeyP":n.paused=!n.paused,n.paused&&e.log("Paused!");break;case"KeyE":downloadAsSVG();break;case"KeyC":e.clearConsole()}e.strategyChooser.onKeyDown(r)})}},{key:"echo",value:function(e){var r=document.createElement("p");r.appendChild(document.createTextNode(e)),this._console.appendChild(r),this._console.scrollTop=this._console.scrollHeight}},{key:"error",value:function(e){var r=document.createElement("p");r.classList.add("error"),r.appendChild(document.createTextNode(e)),this._console.appendChild(r),this._console.scrollTop=this._console.scrollHeight}},{key:"log",value:function(e){this.echo("["+ ++this._logCounter+"]: "+e)}},{key:"exportLearnedSamples",value:function(){return JSON.stringify(main.globalGestureDecisionTree.exportSamples())}},{key:"importLearnedSamples",value:function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];main.globalGestureDecisionTree.importSamples(JSON.parse(e),r)}},{key:"clearConsole",value:function(){for(var e=this._console;e.hasChildNodes();)e.removeChild(e.lastChild)}},{key:"_setupEditor",value:function(){var e=document.getElementById("gestureDefinitions");this.editor=new GestureDefinitionEditor(e),this.editor.setExample(0)}}]),e}(),main=new Main;window.onload=function(){main.initialize()};